
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>DIPY &#8212; dipy 1.8.0dev0 documentation</title>
  
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/dipy.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

  
<link rel="stylesheet" href="../../_static/styles/grg-sphinx-theme.css"/>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'auto_examples/visualization/viz_advanced';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

  <meta name="keywords" content="DIPY, dMRI, DTI, DSI, diffusion MRI, Tensor,
  neuroimaging, python, neuroscience, Eleftherios, Garyfallidis, tractography,
  streamlines, fiber tracking">




  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
<nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">dipy 1.8.0dev0 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../stateoftheart.html">
                        A quick overview of features
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

</nav>
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../stateoftheart.html">
                        A quick overview of features
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="viz_roi_contour.html">Visualization of ROI Surface Rendered with Streamlines</a></li>
<li class="toctree-l1"><a class="reference internal" href="viz_bundles.html">Visualize bundles and metrics on bundles</a></li>
<li class="toctree-l1"><a class="reference internal" href="viz_slice.html">Simple volume slicing</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Advanced interactive visualization</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">DIPY</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
<div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-visualization-viz-advanced-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="advanced-interactive-visualization">
<span id="sphx-glr-auto-examples-visualization-viz-advanced-py"></span><h1>Advanced interactive visualization<a class="headerlink" href="#advanced-interactive-visualization" title="Permalink to this heading">#</a></h1>
<p>In <a class="reference external" href="http://dipy.org">DIPY</a> we created a thin interface to access many of the capabilities
available in the FURY 3D visualization library but tailored to the
needs of structural and diffusion imaging.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="kn">import</span> <span class="n">actor</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">ui</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">window</span></code> we have all the objects that connect what needs to be rendered
to the display or the disk e.g., for saving screenshots. So, there you will
find key objects and functions like the <code class="docutils literal notranslate"><span class="pre">Scene</span></code> class which holds and
provides access to all the actors and the <code class="docutils literal notranslate"><span class="pre">show</span></code> function which displays what
is in the scene on a window. Also, this module provides access to functions
for opening/saving dialogs and printing screenshots (see <code class="docutils literal notranslate"><span class="pre">snapshot</span></code>).</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">actor</span></code> module we can find all the different primitives e.g.,
streamtubes, lines, image slices, etc.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">ui</span></code> module we have some other objects which allow to add buttons
and sliders and these interact both with windows and actors. Because of this
they need input from the operating system so they can process events.</p>
<p>Let’s get started. In this tutorial, we will visualize some bundles
together with FA or T1. We will be able to change the slices using
a <code class="docutils literal notranslate"><span class="pre">LineSlider2D</span></code> widget.</p>
<p>First we need to fetch and load some datasets.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dipy.tracking.streamline</span> <span class="kn">import</span> <span class="n">Streamlines</span>
<span class="kn">from</span> <span class="nn">dipy.data.fetcher</span> <span class="kn">import</span> <span class="n">fetch_bundles_2_subjects</span><span class="p">,</span> <span class="n">read_bundles_2_subjects</span>

<span class="n">fetch_bundles_2_subjects</span><span class="p">()</span>
</pre></div>
</div>
<p>The following function outputs a dictionary with the required bundles e.g. <code class="docutils literal notranslate"><span class="pre">af</span>
<span class="pre">left</span></code> (left arcuate fasciculus) and maps, e.g. FA for a specific subject.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">read_bundles_2_subjects</span><span class="p">(</span><span class="s1">&#39;subj_1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="s1">&#39;fa&#39;</span><span class="p">],</span>
                              <span class="p">[</span><span class="s1">&#39;af.left&#39;</span><span class="p">,</span> <span class="s1">&#39;cst.right&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_1&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>We will use 3 bundles, FA and the affine transformation that brings the voxel
coordinates to world coordinates (RAS 1mm).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">streamlines</span> <span class="o">=</span> <span class="n">Streamlines</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;af.left&#39;</span><span class="p">])</span>
<span class="n">streamlines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;cst.right&#39;</span><span class="p">])</span>
<span class="n">streamlines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;cc_1&#39;</span><span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;fa&#39;</span><span class="p">]</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="n">affine</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;affine&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>With our current design it is easy to decide in which space you want the
streamlines and slices to appear. The default we have here is to appear in
world coordinates (RAS 1mm).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">world_coords</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>If we want to see the objects in native space we need to make sure that all
objects which are currently in world coordinates are transformed back to
native space using the inverse of the affine.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">world_coords</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">dipy.tracking.streamline</span> <span class="kn">import</span> <a href="../../reference/dipy.tracking.html#dipy.tracking.streamline.transform_streamlines" title="dipy.tracking.streamline.transform_streamlines" class="sphx-glr-backref-module-dipy-tracking-streamline sphx-glr-backref-type-py-function"><span class="n">transform_streamlines</span></a>
    <span class="n">streamlines</span> <span class="o">=</span> <a href="../../reference/dipy.tracking.html#dipy.tracking.streamline.transform_streamlines" title="dipy.tracking.streamline.transform_streamlines" class="sphx-glr-backref-module-dipy-tracking-streamline sphx-glr-backref-type-py-function"><span class="n">transform_streamlines</span></a><span class="p">(</span><span class="n">streamlines</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">affine</span><span class="p">))</span>
</pre></div>
</div>
<p>Now we create, a <code class="docutils literal notranslate"><span class="pre">Scene</span></code> object and add the streamlines using the <code class="docutils literal notranslate"><span class="pre">line</span></code>
function and an image plane using the <code class="docutils literal notranslate"><span class="pre">slice</span></code> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">stream_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">streamlines</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">world_coords</span><span class="p">:</span>
    <span class="n">image_actor_z</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">slicer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">image_actor_z</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">slicer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">affine</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also change also the opacity of the slicer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slicer_opacity</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">image_actor_z</span><span class="o">.</span><span class="n">opacity</span><span class="p">(</span><span class="n">slicer_opacity</span><span class="p">)</span>
</pre></div>
</div>
<p>We can add additional slicers by copying the original and adjusting the
<code class="docutils literal notranslate"><span class="pre">display_extent</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image_actor_x</span> <span class="o">=</span> <span class="n">image_actor_z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">x_midpoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">image_actor_x</span><span class="o">.</span><span class="n">display_extent</span><span class="p">(</span><span class="n">x_midpoint</span><span class="p">,</span>
                             <span class="n">x_midpoint</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                             <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">image_actor_y</span> <span class="o">=</span> <span class="n">image_actor_z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y_midpoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">image_actor_y</span><span class="o">.</span><span class="n">display_extent</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">y_midpoint</span><span class="p">,</span>
                             <span class="n">y_midpoint</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Connect the actors with the Scene.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">stream_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">image_actor_z</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">image_actor_x</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">image_actor_y</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we would like to change the position of each <code class="docutils literal notranslate"><span class="pre">image_actor</span></code> using a
slider. The sliders are widgets which require access to different areas of the
visualization pipeline and therefore we don’t recommend using them with
<code class="docutils literal notranslate"><span class="pre">show</span></code>. The more appropriate way is to use them with the <code class="docutils literal notranslate"><span class="pre">ShowManager</span></code>
object which allows accessing the pipeline in different areas. Here is how:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_m</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">ShowManager</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">900</span><span class="p">))</span>
<span class="n">show_m</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</pre></div>
</div>
<p>After we have initialized the <code class="docutils literal notranslate"><span class="pre">ShowManager</span></code> we can go ahead and create
sliders to move the slices and change their opacity.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">line_slider_z</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">LineSlider2D</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">max_value</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">initial_value</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="n">text_template</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value:.0f}</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">length</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>

<span class="n">line_slider_x</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">LineSlider2D</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">max_value</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">initial_value</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="n">text_template</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value:.0f}</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">length</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>

<span class="n">line_slider_y</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">LineSlider2D</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">max_value</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">initial_value</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="n">text_template</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{value:.0f}</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">length</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>

<span class="n">opacity_slider</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">LineSlider2D</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                 <span class="n">max_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                 <span class="n">initial_value</span><span class="o">=</span><span class="n">slicer_opacity</span><span class="p">,</span>
                                 <span class="n">length</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we will write callbacks for the sliders and register them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">change_slice_z</span><span class="p">(</span><span class="n">slider</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="n">image_actor_z</span><span class="o">.</span><span class="n">display_extent</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">change_slice_x</span><span class="p">(</span><span class="n">slider</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="n">image_actor_x</span><span class="o">.</span><span class="n">display_extent</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">change_slice_y</span><span class="p">(</span><span class="n">slider</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="n">image_actor_y</span><span class="o">.</span><span class="n">display_extent</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">change_opacity</span><span class="p">(</span><span class="n">slider</span><span class="p">):</span>
    <span class="n">slicer_opacity</span> <span class="o">=</span> <span class="n">slider</span><span class="o">.</span><span class="n">value</span>
    <span class="n">image_actor_z</span><span class="o">.</span><span class="n">opacity</span><span class="p">(</span><span class="n">slicer_opacity</span><span class="p">)</span>
    <span class="n">image_actor_x</span><span class="o">.</span><span class="n">opacity</span><span class="p">(</span><span class="n">slicer_opacity</span><span class="p">)</span>
    <span class="n">image_actor_y</span><span class="o">.</span><span class="n">opacity</span><span class="p">(</span><span class="n">slicer_opacity</span><span class="p">)</span>


<span class="n">line_slider_z</span><span class="o">.</span><span class="n">on_change</span> <span class="o">=</span> <span class="n">change_slice_z</span>
<span class="n">line_slider_x</span><span class="o">.</span><span class="n">on_change</span> <span class="o">=</span> <span class="n">change_slice_x</span>
<span class="n">line_slider_y</span><span class="o">.</span><span class="n">on_change</span> <span class="o">=</span> <span class="n">change_slice_y</span>
<span class="n">opacity_slider</span><span class="o">.</span><span class="n">on_change</span> <span class="o">=</span> <span class="n">change_opacity</span>
</pre></div>
</div>
<p>We’ll also create text labels to identify the sliders.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_label</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">TextBlock2D</span><span class="p">()</span>
    <span class="n">label</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">label</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="n">label</span><span class="o">.</span><span class="n">font_family</span> <span class="o">=</span> <span class="s1">&#39;Arial&#39;</span>
    <span class="n">label</span><span class="o">.</span><span class="n">justification</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
    <span class="n">label</span><span class="o">.</span><span class="n">bold</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">label</span><span class="o">.</span><span class="n">italic</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">label</span><span class="o">.</span><span class="n">shadow</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">label</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">label</span>


<span class="n">line_slider_label_z</span> <span class="o">=</span> <span class="n">build_label</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Z Slice&quot;</span><span class="p">)</span>
<span class="n">line_slider_label_x</span> <span class="o">=</span> <span class="n">build_label</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;X Slice&quot;</span><span class="p">)</span>
<span class="n">line_slider_label_y</span> <span class="o">=</span> <span class="n">build_label</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Y Slice&quot;</span><span class="p">)</span>
<span class="n">opacity_slider_label</span> <span class="o">=</span> <span class="n">build_label</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Opacity&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we will create a <code class="docutils literal notranslate"><span class="pre">panel</span></code> to contain the sliders and labels.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">panel</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">Panel2D</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
                   <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                   <span class="n">opacity</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                   <span class="n">align</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<span class="n">panel</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1030</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>

<span class="n">panel</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">line_slider_label_x</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
<span class="n">panel</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">line_slider_x</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
<span class="n">panel</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">line_slider_label_y</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">))</span>
<span class="n">panel</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">line_slider_y</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">))</span>
<span class="n">panel</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">line_slider_label_z</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">))</span>
<span class="n">panel</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">line_slider_z</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">))</span>
<span class="n">panel</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">opacity_slider_label</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">))</span>
<span class="n">panel</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">opacity_slider</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">))</span>

<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, we can render all the widgets and everything else in the screen and
start the interaction using <code class="docutils literal notranslate"><span class="pre">show_m.start()</span></code>.</p>
<p>However, if you change the window size, the panel will not update its position
properly. The solution to this issue is to update the position of the panel
using its <code class="docutils literal notranslate"><span class="pre">re_align</span></code> method every time the window size changes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">global</span> <span class="n">size</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">win_callback</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">size</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">!=</span> <span class="n">obj</span><span class="o">.</span><span class="n">GetSize</span><span class="p">():</span>
        <span class="n">size_old</span> <span class="o">=</span> <span class="n">size</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
        <span class="n">size_change</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">size_old</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">re_align</span><span class="p">(</span><span class="n">size_change</span><span class="p">)</span>


<span class="n">show_m</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, please set the following variable to <code class="docutils literal notranslate"><span class="pre">True</span></code> to interact with the
datasets in 3D.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">reset_clipping_range</span><span class="p">()</span>

<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>

    <span class="n">show_m</span><span class="o">.</span><span class="n">add_window_callback</span><span class="p">(</span><span class="n">win_callback</span><span class="p">)</span>
    <span class="n">show_m</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="n">show_m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">else</span><span class="p">:</span>

    <span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;bundles_and_3_slices.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">900</span><span class="p">),</span>
                  <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id2">
<img alt="auto_examples/visualization/bundles_and_3_slices.png" src="auto_examples/visualization/bundles_and_3_slices.png" />
<figcaption>
<p><span class="caption-text">A few bundles with interactive slicing.</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">show_m</span>
</pre></div>
</div>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<div role="list" class="citation-list">
<div class="citation" id="garyfallidis2021" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Garyfallidis2021<span class="fn-bracket">]</span></span>
<p>Garyfallidis, Eleftherios, Serge Koudoro, Javier Guaje,
Marc-Alexandre Côté, Soham Biswas, David Reagan, Nasim Anousheh,
Filipi Silva, Geoffrey Fox, and Fury Contributors.
“FURY: advanced scientific visualization.” Journal of Open Source Software
6 no. 64 (2021): 3384.
<a class="reference external" href="https://doi.org/10.21105/joss.03384">https://doi.org/10.21105/joss.03384</a></p>
</div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-visualization-viz-advanced-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/52ac55a246cb13742a797cd833ff2a56/viz_advanced.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">viz_advanced.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/13ecca5df69e5aa3f4bcf362a24e3551/viz_advanced.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">viz_advanced.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  
<script type="module" src="../../_static/scripts/grg-sphinx-theme.js"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2008-2023, dipy developers &lt;neuroimaging@python.org&gt;.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

    <div class="copyright-text">
      <i class="fa-regular fa-copyright"></i> 
    </div>
  </footer>
  </body>
</html>