
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>DIPY &#8212; dipy 1.8.0dev0 documentation</title>
  
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/dipy.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

  
<link rel="stylesheet" href="../../_static/styles/grg-sphinx-theme.css"/>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples_built/segmentation/bundle_extraction';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

  <meta name="keywords" content="DIPY, dMRI, DTI, DSI, diffusion MRI, Tensor,
  neuroimaging, python, neuroscience, Eleftherios, Garyfallidis, tractography,
  streamlines, fiber tracking">




  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
<nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">dipy 1.8.0dev0 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../stateoftheart.html">
                        A quick overview of features
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

</nav>
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../stateoftheart.html">
                        A quick overview of features
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">DIPY</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
<div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-built-segmentation-bundle-extraction-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="automatic-fiber-bundle-extraction-with-recobundles">
<span id="sphx-glr-examples-built-segmentation-bundle-extraction-py"></span><h1>Automatic Fiber Bundle Extraction with RecoBundles<a class="headerlink" href="#automatic-fiber-bundle-extraction-with-recobundles" title="Permalink to this heading">#</a></h1>
<p>This example explains how we can use RecoBundles <a class="reference internal" href="../../reference_cmd/dipy_slr.html#garyfallidis17" id="id1"><span>[Garyfallidis17]</span></a> to extract
bundles from tractograms.</p>
<p>First import the necessary modules.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">dipy.align.streamlinear</span> <span class="kn">import</span> <span class="n">whole_brain_slr</span>
<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="n">get_two_hcp842_bundles</span>
<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="p">(</span><span class="n">fetch_target_tractogram_hcp</span><span class="p">,</span>
                       <span class="n">fetch_bundle_atlas_hcp842</span><span class="p">,</span>
                       <span class="n">get_bundle_atlas_hcp842</span><span class="p">,</span>
                       <span class="n">get_target_tractogram_hcp</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">dipy.io.stateful_tractogram</span> <span class="kn">import</span> <span class="n">Space</span><span class="p">,</span> <span class="n">StatefulTractogram</span>
<span class="kn">from</span> <span class="nn">dipy.io.streamline</span> <span class="kn">import</span> <span class="n">load_trk</span><span class="p">,</span> <span class="n">save_trk</span>
<span class="kn">from</span> <span class="nn">dipy.io.utils</span> <span class="kn">import</span> <span class="n">create_tractogram_header</span>
<span class="kn">from</span> <span class="nn">dipy.segment.bundles</span> <span class="kn">import</span> <span class="n">RecoBundles</span>
<span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="kn">import</span> <span class="n">actor</span><span class="p">,</span> <span class="n">window</span>
</pre></div>
</div>
<p>Download and read data for this tutorial</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">target_file</span><span class="p">,</span> <span class="n">target_folder</span> <span class="o">=</span> <span class="n">fetch_target_tractogram_hcp</span><span class="p">()</span>
<span class="n">atlas_file</span><span class="p">,</span> <span class="n">atlas_folder</span> <span class="o">=</span> <span class="n">fetch_bundle_atlas_hcp842</span><span class="p">()</span>

<span class="n">atlas_file</span><span class="p">,</span> <span class="n">all_bundles_files</span> <span class="o">=</span> <span class="n">get_bundle_atlas_hcp842</span><span class="p">()</span>
<span class="n">target_file</span> <span class="o">=</span> <span class="n">get_target_tractogram_hcp</span><span class="p">()</span>

<span class="n">sft_atlas</span> <span class="o">=</span> <span class="n">load_trk</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">,</span> <span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">atlas</span> <span class="o">=</span> <span class="n">sft_atlas</span><span class="o">.</span><span class="n">streamlines</span>
<span class="n">atlas_header</span> <span class="o">=</span> <span class="n">create_tractogram_header</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">,</span>
                                        <span class="o">*</span><span class="n">sft_atlas</span><span class="o">.</span><span class="n">space_attributes</span><span class="p">)</span>

<span class="n">sft_target</span> <span class="o">=</span> <span class="n">load_trk</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">sft_target</span><span class="o">.</span><span class="n">streamlines</span>
<span class="n">target_header</span> <span class="o">=</span> <span class="n">create_tractogram_header</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span>
                                         <span class="o">*</span><span class="n">sft_target</span><span class="o">.</span><span class="n">space_attributes</span><span class="p">)</span>
</pre></div>
</div>
<p>let’s visualize atlas tractogram and target tractogram before registration</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">atlas</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;tractograms_initial.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id5">
<img alt="examples_built/segmentation/tractograms_initial.png" src="examples_built/segmentation/tractograms_initial.png" />
<figcaption>
<p><span class="caption-text">Atlas and target before registration.</span><a class="headerlink" href="#id5" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We will register target tractogram to model atlas’ space using streamlinear
registration (SLR) <a class="reference internal" href="../../reference_cmd/dipy_slr.html#garyfallidis15" id="id2"><span>[Garyfallidis15]</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">moved</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">qb_centroids1</span><span class="p">,</span> <span class="n">qb_centroids2</span> <span class="o">=</span> <span class="n">whole_brain_slr</span><span class="p">(</span>
    <span class="n">atlas</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="s1">&#39;affine&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">progressive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">rng</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">1984</span><span class="p">))</span>
</pre></div>
</div>
<p>We save the transform generated in this registration, so that we can use
it in the bundle profiles example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;slr_transform.npy&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span>
</pre></div>
</div>
<p>let’s visualize atlas tractogram and target tractogram after registration</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">atlas</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">moved</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;tractograms_after_registration.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id6">
<img alt="examples_built/segmentation/tractograms_after_registration.png" src="examples_built/segmentation/tractograms_after_registration.png" />
<figcaption>
<p><span class="caption-text">Atlas and target after registration.</span><a class="headerlink" href="#id6" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Extracting bundles using RecoBundles <a class="reference internal" href="../../reference_cmd/dipy_slr.html#garyfallidis17" id="id3"><span>[Garyfallidis17]</span></a></p>
<p>RecoBundles requires a model (reference) bundle and tries to extract similar
looking bundle from the input tractogram. There are some key parameters that
users can set as per requirements. Here are the key threshold parameters
measured in millimeters and their function in Recobundles:</p>
<blockquote>
<div><ul class="simple">
<li><p>model_clust_thr : It will use QuickBundles to get the centroids of the</p></li>
</ul>
<p>model bundle and work with centroids instead of all streamlines. This helps
to make RecoBundles faster. The larger the value of the threshold, the
fewer centroids will be, the and smaller the threshold value, the more
centroids will be. If you prefer to use all the streamlines of the model
bundle, you can set this threshold to 0.01 mm.
Recommended range of the model_clust_thr is 0.01 - 3.0 mm.</p>
<ul class="simple">
<li><p>reduction_thr : This threshold will be used to reduce the search space</p></li>
</ul>
<p>for finding the streamlines that match model bundle streamlines in shape.
Instead of looking at the entire tractogram, now we will be looking at
neighboring region of a model bundle in the tractogram. Increase the
threshold to increase the search space.
Recommended range of the reduction_thr is 15 - 30 mm.</p>
<ul class="simple">
<li><p>pruning_thr : This threshold will filter the streamlines for which the</p></li>
</ul>
<p>distance to the model bundle is greater than the pruning_thr.
This serves to filter the neighborhood area (search space) to get
streamlines that are like the model bundle.
Recommended range of the pruning_thr is 8 - 12 mm.</p>
<ul class="simple">
<li><p>reduction_distance and pruning_distance : Distance method used internally.</p></li>
</ul>
<p>Minimum Diferect Flip distance (mdf) or Mean Average Minimum (mam).
Default is set to mdf.</p>
<ul class="simple">
<li><p>slr : If slr flag is set to True, local registration of model bundle with</p></li>
</ul>
<p>neighbouring area will be performed. Default and recommended is True.</p>
</div></blockquote>
<p>Read Arcuate Fasciculus Left and Corticospinal Tract Left bundles from already
fetched atlas data to use them as model bundle. Let’s visualize the
Arcuate Fasciculus Left model bundle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_af_l_file</span><span class="p">,</span> <span class="n">model_cst_l_file</span> <span class="o">=</span> <span class="n">get_two_hcp842_bundles</span><span class="p">()</span>
<span class="n">sft_af_l</span> <span class="o">=</span> <span class="n">load_trk</span><span class="p">(</span><span class="n">model_af_l_file</span><span class="p">,</span> <span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">model_af_l</span> <span class="o">=</span> <span class="n">sft_af_l</span><span class="o">.</span><span class="n">streamlines</span>

<span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">model_af_l</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.17281532</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.55606842</span><span class="p">,</span> <span class="mf">6.92485857</span><span class="p">),</span>
                 <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">360.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.44</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;AF_L_model_bundle.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id7">
<img alt="examples_built/segmentation/AF_L_model_bundle.png" src="examples_built/segmentation/AF_L_model_bundle.png" />
<figcaption>
<p><span class="caption-text">Model Arcuate Fasciculus Left bundle</span><a class="headerlink" href="#id7" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rb</span> <span class="o">=</span> <span class="n">RecoBundles</span><span class="p">(</span><span class="n">moved</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">2001</span><span class="p">))</span>

<span class="n">recognized_af_l</span><span class="p">,</span> <span class="n">af_l_labels</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">recognize</span><span class="p">(</span><span class="n">model_bundle</span><span class="o">=</span><span class="n">model_af_l</span><span class="p">,</span>
                                            <span class="n">model_clust_thr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                            <span class="n">reduction_thr</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                                            <span class="n">pruning_thr</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                                            <span class="n">reduction_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                            <span class="n">pruning_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                            <span class="n">slr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>let’s visualize extracted Arcuate Fasciculus Left bundle</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">recognized_af_l</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.17281532</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.55606842</span><span class="p">,</span> <span class="mf">6.92485857</span><span class="p">),</span>
                 <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">360.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.44</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;AF_L_recognized_bundle.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id8">
<img alt="examples_built/segmentation/AF_L_recognized_bundle.png" src="examples_built/segmentation/AF_L_recognized_bundle.png" />
<figcaption>
<p><span class="caption-text">Extracted Arcuate Fasciculus Left bundle</span><a class="headerlink" href="#id8" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Save the bundle as a trk file. Let’s save the recognized bundle in the
common space (atlas space), in this case, MNI space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_af_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">recognized_af_l</span><span class="p">,</span> <span class="n">atlas_header</span><span class="p">,</span>
                               <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_af_l</span><span class="p">,</span> <span class="s2">&quot;AF_L_rec_1.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s save the recognized bundle in the original space of the subject anatomy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_af_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">af_l_labels</span><span class="p">],</span> <span class="n">target_header</span><span class="p">,</span>
                               <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_af_l</span><span class="p">,</span> <span class="s2">&quot;AF_L_org_1.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, let’s increase the reduction_thr and pruning_thr values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recognized_af_l</span><span class="p">,</span> <span class="n">af_l_labels</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">recognize</span><span class="p">(</span><span class="n">model_bundle</span><span class="o">=</span><span class="n">model_af_l</span><span class="p">,</span>
                                            <span class="n">model_clust_thr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                            <span class="n">reduction_thr</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                            <span class="n">pruning_thr</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                            <span class="n">reduction_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                            <span class="n">pruning_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                            <span class="n">slr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>let’s visualize extracted Arcuate Fasciculus Left bundle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">recognized_af_l</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.17281532</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.55606842</span><span class="p">,</span> <span class="mf">6.92485857</span><span class="p">),</span>
                 <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">360.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.44</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;AF_L_recognized_bundle2.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id9">
<img alt="examples_built/segmentation/AF_L_recognized_bundle2.png" src="examples_built/segmentation/AF_L_recognized_bundle2.png" />
<figcaption>
<p><span class="caption-text">Extracted Arcuate Fasciculus Left bundle</span><a class="headerlink" href="#id9" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Save the bundle as a trk file. Let’s save the recognized bundle in the
common space (atlas space), in this case, MNI space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_af_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">recognized_af_l</span><span class="p">,</span> <span class="n">atlas_header</span><span class="p">,</span>
                               <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_af_l</span><span class="p">,</span> <span class="s2">&quot;AF_L_rec_2.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s save the recognized bundle in the original space of the subject anatomy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_af_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">af_l_labels</span><span class="p">],</span> <span class="n">target_header</span><span class="p">,</span>
                               <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_af_l</span><span class="p">,</span> <span class="s2">&quot;AF_L_org_2.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, let’s increase the reduction_thr and pruning_thr values further.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recognized_af_l</span><span class="p">,</span> <span class="n">af_l_labels</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">recognize</span><span class="p">(</span><span class="n">model_bundle</span><span class="o">=</span><span class="n">model_af_l</span><span class="p">,</span>
                                            <span class="n">model_clust_thr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                            <span class="n">reduction_thr</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                                            <span class="n">pruning_thr</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                                            <span class="n">reduction_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                            <span class="n">pruning_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                            <span class="n">slr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>let’s visualize extracted Arcuate Fasciculus Left bundle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">recognized_af_l</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.17281532</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.55606842</span><span class="p">,</span> <span class="mf">6.92485857</span><span class="p">),</span>
                 <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">360.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.44</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;AF_L_recognized_bundle3.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id10">
<img alt="examples_built/segmentation/AF_L_recognized_bundle3.png" src="examples_built/segmentation/AF_L_recognized_bundle3.png" />
<figcaption>
<p><span class="caption-text">Extracted Arcuate Fasciculus Left bundle</span><a class="headerlink" href="#id10" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Save the bundle as a trk file. Let’s save the recognized bundle in the
common space (atlas space), in this case, MNI space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_af_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">recognized_af_l</span><span class="p">,</span> <span class="n">atlas_header</span><span class="p">,</span>
                               <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_af_l</span><span class="p">,</span> <span class="s2">&quot;AF_L_rec_3.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s save the recognized bundle in the original space of the subject anatomy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_af_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">af_l_labels</span><span class="p">],</span> <span class="n">target_header</span><span class="p">,</span>
                               <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_af_l</span><span class="p">,</span> <span class="s2">&quot;AF_L_org_3.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s apply auto-calibrated RecoBundles on the output of standard RecoBundles.
This step will filter out the outlier streamlines. This time, the RecoBundles’
extracted bundle will serve as a model bundle. As a rule of thumb, provide
larger threshold values in standard RecoBundles function and smaller values in
the auto-calibrated RecoBundles (refinement) step.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r_recognized_af_l</span><span class="p">,</span> <span class="n">r_af_l_labels</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="n">model_bundle</span><span class="o">=</span><span class="n">model_af_l</span><span class="p">,</span>
                                             <span class="n">pruned_streamlines</span><span class="o">=</span><span class="n">recognized_af_l</span><span class="p">,</span>
                                             <span class="n">model_clust_thr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                             <span class="n">reduction_thr</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                                             <span class="n">pruning_thr</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                             <span class="n">reduction_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                             <span class="n">pruning_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                             <span class="n">slr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>let’s visualize extracted refined Arcuate Fasciculus Left bundle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">r_recognized_af_l</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.17281532</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.55606842</span><span class="p">,</span> <span class="mf">6.92485857</span><span class="p">),</span>
                 <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">360.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.44</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;AF_L_refine_recognized_bundle.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id11">
<img alt="examples_built/segmentation/AF_L_refine_recognized_bundle.png" src="examples_built/segmentation/AF_L_refine_recognized_bundle.png" />
<figcaption>
<p><span class="caption-text">Extracted Arcuate Fasciculus Left bundle</span><a class="headerlink" href="#id11" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Save the bundle as a trk file. Let’s save the recognized bundle in the
common space (atlas space), in this case, MNI space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_af_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">r_recognized_af_l</span><span class="p">,</span> <span class="n">atlas_header</span><span class="p">,</span>
                               <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_af_l</span><span class="p">,</span> <span class="s2">&quot;AF_L_rec_refine.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s save the recognized bundle in the original space of the subject anatomy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_af_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">r_af_l_labels</span><span class="p">],</span> <span class="n">target_header</span><span class="p">,</span>
                               <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_af_l</span><span class="p">,</span> <span class="s2">&quot;AF_L_org_refine.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s load Corticospinal Tract Left model bundle and visualize it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sft_cst_l</span> <span class="o">=</span> <span class="n">load_trk</span><span class="p">(</span><span class="n">model_cst_l_file</span><span class="p">,</span> <span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">model_cst_l</span> <span class="o">=</span> <span class="n">sft_cst_l</span><span class="o">.</span><span class="n">streamlines</span>

<span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">model_cst_l</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.17281532</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.55606842</span><span class="p">,</span> <span class="mf">6.92485857</span><span class="p">),</span>
                 <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">360.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.44</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;CST_L_model_bundle.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id12">
<img alt="examples_built/segmentation/CST_L_model_bundle.png" src="examples_built/segmentation/CST_L_model_bundle.png" />
<figcaption>
<p><span class="caption-text">The Corticospinal tract model bundle</span><a class="headerlink" href="#id12" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recognized_cst_l</span><span class="p">,</span> <span class="n">cst_l_labels</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">recognize</span><span class="p">(</span><span class="n">model_bundle</span><span class="o">=</span><span class="n">model_cst_l</span><span class="p">,</span>
                                              <span class="n">model_clust_thr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                              <span class="n">reduction_thr</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                                              <span class="n">pruning_thr</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                                              <span class="n">reduction_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                              <span class="n">pruning_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                              <span class="n">slr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>let’s visualize extracted Corticospinal tract Left bundle</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">recognized_cst_l</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.17281532</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.55606842</span><span class="p">,</span> <span class="mf">6.92485857</span><span class="p">),</span>
                 <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">360.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.44</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;CST_L_recognized_bundle.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id13">
<img alt="examples_built/segmentation/CST_L_recognized_bundle.png" src="examples_built/segmentation/CST_L_recognized_bundle.png" />
<figcaption>
<p><span class="caption-text">Extracted Corticospinal tract Left bundle</span><a class="headerlink" href="#id13" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Save the bundle as a trk file. Let’s save the recognized bundle in the
common space (atlas space), in this case, MNI space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_cst_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">recognized_cst_l</span><span class="p">,</span> <span class="n">atlas_header</span><span class="p">,</span>
                                <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_cst_l</span><span class="p">,</span> <span class="s2">&quot;CST_L_rec_1.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s save the recognized bundle in the original space of the subject anatomy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_cst_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">cst_l_labels</span><span class="p">],</span> <span class="n">target_header</span><span class="p">,</span>
                                <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_cst_l</span><span class="p">,</span> <span class="s2">&quot;CST_L_org_1.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, let’s increase the reduction_thr and pruning_thr values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recognized_cst_l</span><span class="p">,</span> <span class="n">cst_l_labels</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">recognize</span><span class="p">(</span><span class="n">model_bundle</span><span class="o">=</span><span class="n">model_cst_l</span><span class="p">,</span>
                                              <span class="n">model_clust_thr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                              <span class="n">reduction_thr</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                              <span class="n">pruning_thr</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                              <span class="n">reduction_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                              <span class="n">pruning_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                              <span class="n">slr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>let’s visualize extracted Corticospinal tract Left bundle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">recognized_cst_l</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.17281532</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.55606842</span><span class="p">,</span> <span class="mf">6.92485857</span><span class="p">),</span>
                 <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">360.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.44</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;CST_L_recognized_bundle2.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id14">
<img alt="examples_built/segmentation/CST_L_recognized_bundle2.png" src="examples_built/segmentation/CST_L_recognized_bundle2.png" />
<figcaption>
<p><span class="caption-text">Extracted Corticospinal tract Left bundle</span><a class="headerlink" href="#id14" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Save the bundle as a trk file. Let’s save the recognized bundle in the
common space (atlas space), in this case, MNI space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_cst_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">recognized_cst_l</span><span class="p">,</span> <span class="n">atlas_header</span><span class="p">,</span>
                                <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_cst_l</span><span class="p">,</span> <span class="s2">&quot;CST_L_rec_2.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s save the recognized bundle in the original space of the subject anatomy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_cst_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">cst_l_labels</span><span class="p">],</span> <span class="n">target_header</span><span class="p">,</span>
                                <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_cst_l</span><span class="p">,</span> <span class="s2">&quot;CST_L_org_2.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, let’s increase the reduction_thr and pruning_thr values further.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recognized_cst_l</span><span class="p">,</span> <span class="n">cst_l_labels</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">recognize</span><span class="p">(</span><span class="n">model_bundle</span><span class="o">=</span><span class="n">model_cst_l</span><span class="p">,</span>
                                              <span class="n">model_clust_thr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                              <span class="n">reduction_thr</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                                              <span class="n">pruning_thr</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                                              <span class="n">reduction_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                              <span class="n">pruning_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                              <span class="n">slr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>let’s visualize extracted Corticospinal tract Left bundle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">recognized_cst_l</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.17281532</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.55606842</span><span class="p">,</span> <span class="mf">6.92485857</span><span class="p">),</span>
                 <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">360.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.44</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;CST_L_recognized_bundle3.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id15">
<img alt="examples_built/segmentation/CST_L_recognized_bundle3.png" src="examples_built/segmentation/CST_L_recognized_bundle3.png" />
<figcaption>
<p><span class="caption-text">Extracted Corticospinal tract Left bundle</span><a class="headerlink" href="#id15" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Save the bundle as a trk file. Let’s save the recognized bundle in the
common space (atlas space), in this case, MNI space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_cst_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">recognized_cst_l</span><span class="p">,</span> <span class="n">atlas_header</span><span class="p">,</span>
                                <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_cst_l</span><span class="p">,</span> <span class="s2">&quot;CST_L_rec_3.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s save the recognized bundle in the original space of the subject anatomy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_cst_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">cst_l_labels</span><span class="p">],</span> <span class="n">target_header</span><span class="p">,</span>
                                <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_cst_l</span><span class="p">,</span> <span class="s2">&quot;CST_L_org_3.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s apply auto-calibrated RecoBundles on the output of standard RecoBundles.
This step will filter out the outlier streamlines. This time, the RecoBundles’
extracted bundle will serve as a model bundle. As a rule of thumb, provide
larger threshold values in standard RecoBundles function and smaller values in
the auto-calibrated RecoBundles (refinement) step.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r_recognized_cst_l</span><span class="p">,</span> <span class="n">r_cst_l_labels</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span>
                                     <span class="n">model_bundle</span><span class="o">=</span><span class="n">model_cst_l</span><span class="p">,</span>
                                     <span class="n">pruned_streamlines</span><span class="o">=</span><span class="n">recognized_cst_l</span><span class="p">,</span>
                                     <span class="n">model_clust_thr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                     <span class="n">reduction_thr</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                                     <span class="n">pruning_thr</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                     <span class="n">reduction_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                     <span class="n">pruning_distance</span><span class="o">=</span><span class="s1">&#39;mdf&#39;</span><span class="p">,</span>
                                     <span class="n">slr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>let’s visualize extracted refined Corticospinal tract Left bundle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">r_recognized_cst_l</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.17281532</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.55606842</span><span class="p">,</span> <span class="mf">6.92485857</span><span class="p">),</span>
                 <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">360.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.44</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;CST_L_refine_recognized_bundle.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id16">
<img alt="examples_built/segmentation/CST_L_refine_recognized_bundle.png" src="examples_built/segmentation/CST_L_refine_recognized_bundle.png" />
<figcaption>
<p><span class="caption-text">Extracted refined Corticospinal tract Left bundle</span><a class="headerlink" href="#id16" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Save the bundle as a trk file. Let’s save the recognized bundle in the
common space (atlas space), in this case, MNI space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_cst_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">r_recognized_cst_l</span><span class="p">,</span> <span class="n">atlas_header</span><span class="p">,</span>
                                <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_cst_l</span><span class="p">,</span> <span class="s2">&quot;CST_L_rec_refine.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s save the recognized bundle in the original space of the subject anatomy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reco_cst_l</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">r_cst_l_labels</span><span class="p">],</span> <span class="n">target_header</span><span class="p">,</span>
                                <span class="n">Space</span><span class="o">.</span><span class="n">RASMM</span><span class="p">)</span>
<span class="n">save_trk</span><span class="p">(</span><span class="n">reco_cst_l</span><span class="p">,</span> <span class="s2">&quot;CST_L_org_refine.trk&quot;</span><span class="p">,</span> <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>This example shows how changing different threshold parameters can change the
output. It is up to the user to decide what is the desired output and select
parameters accordingly.</p>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<div role="list" class="citation-list">
<div class="citation" id="garyfallidis17" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Garyfallidis17<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id3">2</a>)</span>
<p>Garyfallidis et al. Recognition of white matter
bundles using local and global streamline-based registration
and clustering, Neuroimage, 2017.</p>
</div>
<div class="citation" id="chandio2020" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Chandio2020<span class="fn-bracket">]</span></span>
<p>Chandio, B.Q., Risacher, S.L., Pestilli, F.,
Bullock, D., Yeh, FC., Koudoro, S., Rokem, A., Harezlak, J., and
Garyfallidis, E. Bundle analytics, a computational framework for
investigating the shapes and profiles of brain pathways across
populations. Sci Rep 10, 17149 (2020)</p>
</div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-built-segmentation-bundle-extraction-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/e76ad6f3bad0dd70d0fa0d57bcf7cb20/bundle_extraction.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">bundle_extraction.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/e1c714fc1286aae07efab239a0a2d193/bundle_extraction.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">bundle_extraction.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  
<script type="module" src="../../_static/scripts/grg-sphinx-theme.js"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2008-2023, dipy developers &lt;neuroimaging@python.org&gt;.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

    <div class="copyright-text">
      <i class="fa-regular fa-copyright"></i> 
    </div>
  </footer>
  </body>
</html>