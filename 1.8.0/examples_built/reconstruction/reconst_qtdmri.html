
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>DIPY &#8212; dipy 1.8.0dev0 documentation</title>
  
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/dipy.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

  
<link rel="stylesheet" href="../../_static/styles/grg-sphinx-theme.css"/>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples_built/reconstruction/reconst_qtdmri';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

  <meta name="keywords" content="DIPY, dMRI, DTI, DSI, diffusion MRI, Tensor,
  neuroimaging, python, neuroscience, Eleftherios, Garyfallidis, tractography,
  streamlines, fiber tracking">




  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
<nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">dipy 1.8.0dev0 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../stateoftheart.html">
                        A quick overview of features
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

</nav>
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../stateoftheart.html">
                        A quick overview of features
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">DIPY</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
<div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-built-reconstruction-reconst-qtdmri-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="estimating-diffusion-time-dependent-q-space-indices-using-qt-dmri">
<span id="sphx-glr-examples-built-reconstruction-reconst-qtdmri-py"></span><h1>Estimating diffusion time dependent q-space indices using qt-dMRI<a class="headerlink" href="#estimating-diffusion-time-dependent-q-space-indices-using-qt-dmri" title="Permalink to this heading">#</a></h1>
<p>Effective representation of the four-dimensional diffusion MRI signal –
varying over three-dimensional q-space and diffusion time – is a sought-after
and still unsolved challenge in diffusion MRI (dMRI). We propose a functional
basis approach that is specifically designed to represent the dMRI signal in
this qtau-space <span id="id1">[Fick2017]</span>.  Following recent terminology, we refer to our
qtau-functional basis as <span class="math notranslate nohighlight">\(q       au\)</span>-dMRI. We use GraphNet regularization –
imposing both signal smoothness and sparsity – to drastically reduce the
number of diffusion-weighted images (DWIs) that is needed to represent the dMRI
signal in the qtau-space. As the main contribution, <span class="math notranslate nohighlight">\(q    au\)</span>-dMRI provides
the framework to – without making biophysical assumptions – represent the
<span class="math notranslate nohighlight">\(q        au\)</span>-space signal and estimate time-dependent q-space indices
(<span class="math notranslate nohighlight">\(q       au\)</span>-indices), providing a new means for studying diffusion in
nervous tissue. <span class="math notranslate nohighlight">\(q        au\)</span>-dMRI is the first of its kind in being
specifically designed to provide open interpretation of the
<span class="math notranslate nohighlight">\(q        au\)</span>-diffusion signal.</p>
<p><span class="math notranslate nohighlight">\(q        au\)</span>-dMRI can be seen as a time-dependent extension of the MAP-MRI
functional basis <a class="reference internal" href="reconst_mapmri.html#ozarslan2013" id="id2"><span>[Ozarslan2013]</span></a>, and all the previously proposed q-space
can be estimated for any diffusion time. These include rotationally
invariant quantities such as the Mean Squared Displacement (MSD), Q-space
Inverse Variance (QIV) and Return-To-Origin Probability (RTOP). Also
directional indices such as the Return To the Axis Probability (RTAP) and
Return To the Plane Probability (RTPP) are available, as well as the
Orientation Distribution Function (ODF).</p>
<p>In this example we illustrate how to use the <span class="math notranslate nohighlight">\(q   au\)</span>-dMRI to estimate
time-dependent q-space indices from a <span class="math notranslate nohighlight">\(q  au\)</span>-acquisition of a mouse.</p>
<p>First import the necessary modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dipy.data.fetcher</span> <span class="kn">import</span> <span class="p">(</span><span class="n">fetch_qtdMRI_test_retest_2subjects</span><span class="p">,</span>
                               <span class="n">read_qtdMRI_test_retest_2subjects</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">dipy.reconst</span> <span class="kn">import</span> <span class="n">qtdmri</span><span class="p">,</span> <span class="n">dti</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>Download and read the data for this tutorial.</p>
<p><span class="math notranslate nohighlight">\(q\tau\)</span>-dMRI requires data with multiple gradient directions, gradient
strength and diffusion times. We will use the test-retest acquisitions of two
mice that were used in the test-retest study by <span id="id3">[Fick2017]</span>. The data itself
is freely available and citeable at <span id="id4">[Wassermann2017]</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fetch_qtdMRI_test_retest_2subjects</span><span class="p">()</span>
<span class="n">data</span><span class="p">,</span> <span class="n">cc_masks</span><span class="p">,</span> <span class="n">gtabs</span> <span class="o">=</span> <span class="n">read_qtdMRI_test_retest_2subjects</span><span class="p">()</span>
</pre></div>
</div>
<p>data contains 4 qt-dMRI datasets of size [80, 160, 5, 515]. The first two are
the test-retest datasets of the first mouse and the second two are those of the
second mouse. cc_masks contains 4 corresponding binary masks for the corpus
callosum voxels in the middle slice that were used in the test-retest study.
Finally, gtab contains the qt-dMRI gradient tables for the DWIs in the dataset.</p>
<p>The data consists of 515 DWIs, divided over 35 shells, with 7 “gradient
strength shells” up to 491 mT/m, 5 equally spaced “pulse separation shells”
(big_delta) between [10.8-20] ms and a pulse duration (small_delta) of 5ms.</p>
<p>To visualize qt-dMRI acquisition schemes in an intuitive way, the qtdmri module
provides a visualization function to illustrate the relationship between
gradient strength (G), pulse separation (big_delta) and b-value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">qtdmri</span><span class="o">.</span><span class="n">visualise_gradient_table_G_Delta_rainbow</span><span class="p">(</span><span class="n">gtabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;qt-dMRI_acquisition_scheme.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center">
<img alt="examples_built/reconstruction/qt-dMRI_acquisition_scheme.png" src="examples_built/reconstruction/qt-dMRI_acquisition_scheme.png" />
</figure>
<p>In the figure the dots represent measured DWIs in any direction, for a given
gradient strength and pulse separation. The background isolines represent the
corresponding b-values for different combinations of G and big_delta.</p>
<p>Next, we visualize the middle slices of the test-retest data sets with their
corresponding masks. To better illustrate the white matter architecture in the
data, we calculate DTI’s fractional anisotropy (FA) over the whole slice and
project the corpus callosum mask on the FA image.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subplot_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Subject1 Test&quot;</span><span class="p">,</span> <span class="s2">&quot;Subject1 Retest&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Subject2 Test&quot;</span><span class="p">,</span> <span class="s2">&quot;Subject2 Retest&quot;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">mask_</span><span class="p">,</span> <span class="n">gtab_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cc_masks</span><span class="p">,</span> <span class="n">gtabs</span><span class="p">)):</span>
    <span class="c1"># take the middle slice</span>
    <span class="n">data_middle_slice</span> <span class="o">=</span> <span class="n">data_</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">mask_middle_slice</span> <span class="o">=</span> <span class="n">mask_</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="c1"># estimate fractional anisotropy (FA) for this slice</span>
    <span class="n">tenmod</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">TensorModel</span><span class="p">(</span><span class="n">gtab_</span><span class="p">)</span>
    <span class="n">tenfit</span> <span class="o">=</span> <span class="n">tenmod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_middle_slice</span><span class="p">,</span> <span class="n">data_middle_slice</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">fa</span> <span class="o">=</span> <span class="n">tenfit</span><span class="o">.</span><span class="n">fa</span>

    <span class="c1"># set mask color to green with 0.5 opacity as overlay</span>
    <span class="n">mask_template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">mask_middle_slice</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">mask_template</span><span class="p">[</span><span class="n">mask_middle_slice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">.5</span><span class="p">]</span>

    <span class="c1"># produce the FA images with corpus callosum masks.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">subplot_titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask_template</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;qt-dMRI_datasets_fa_with_ccmasks.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center">
<img alt="examples_built/reconstruction/qt-dMRI_datasets_fa_with_ccmasks.png" src="examples_built/reconstruction/qt-dMRI_datasets_fa_with_ccmasks.png" />
</figure>
<p>Next, we use qt-dMRI to estimate of time-dependent q-space indices
(q:math:<cite>tau</cite>-indices) for the masked voxels in the corpus callosum of each dataset.
In particular, we estimate the Return-to-Original, Return-to-Axis and
Return-to-Plane Probability (RTOP, RTAP and RTPP), as well as the Mean Squared
Displacement (MSD).</p>
<p>In this example we don’t extrapolate the data beyond the maximum diffusion
time, so we estimate <span class="math notranslate nohighlight">\(q\tau\)</span> indices between the minimum and maximum
diffusion times of the data at 5 equally spaced points. However, it should the
noted that qt-dMRI’s combined smoothness and sparsity regularization allows
for smooth interpolation at any <span class="math notranslate nohighlight">\(q\tau\)</span> position. In other words, once
the basis is fitted to the data, its coefficients describe the the entire
<span class="math notranslate nohighlight">\(q\tau\)</span>-space, and any <span class="math notranslate nohighlight">\(q\tau\)</span>-position can be freely recovered.
This including points beyond the dataset’s maximum <span class="math notranslate nohighlight">\(q\tau\)</span> value
(although this should be done with caution).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tau_min</span> <span class="o">=</span> <span class="n">gtabs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tau</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">tau_max</span> <span class="o">=</span> <span class="n">gtabs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tau</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">taus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tau_min</span><span class="p">,</span> <span class="n">tau_max</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">qtdmri_fits</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">msds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rtops</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rtaps</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rtpps</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">mask_</span><span class="p">,</span> <span class="n">gtab_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cc_masks</span><span class="p">,</span> <span class="n">gtabs</span><span class="p">)):</span>
    <span class="c1"># select the corpus callosum voxel for every dataset</span>
    <span class="n">cc_voxels</span> <span class="o">=</span> <span class="n">data_</span><span class="p">[</span><span class="n">mask_</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># initialize the qt-dMRI model.</span>
    <span class="c1"># recommended basis orders are radial_order=6 and time_order=2.</span>
    <span class="c1"># The combined Laplacian and l1-regularization using Generalized</span>
    <span class="c1"># Cross-Validation (GCV) and Cross-Validation (CV) settings is most robust,</span>
    <span class="c1"># but can be used separately and with weightings preset to any positive</span>
    <span class="c1"># value to optimize for speed.</span>
    <span class="n">qtdmri_mod</span> <span class="o">=</span> <span class="n">qtdmri</span><span class="o">.</span><span class="n">QtdmriModel</span><span class="p">(</span>
        <span class="n">gtab_</span><span class="p">,</span> <span class="n">radial_order</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">time_order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">laplacian_regularization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">laplacian_weighting</span><span class="o">=</span><span class="s1">&#39;GCV&#39;</span><span class="p">,</span>
        <span class="n">l1_regularization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">l1_weighting</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span>
    <span class="p">)</span>
    <span class="c1"># fit the model.</span>
    <span class="c1"># Here we take every 5th voxel for speed, but of course all voxels can be</span>
    <span class="c1"># fit for a more robust result later on.</span>
    <span class="n">qtdmri_fit</span> <span class="o">=</span> <span class="n">qtdmri_mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cc_voxels</span><span class="p">[::</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">qtdmri_fits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qtdmri_fit</span><span class="p">)</span>
    <span class="c1"># We estimate MSD, RTOP, RTAP and RTPP for the chosen diffusion times.</span>
    <span class="n">msds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">qtdmri_fit</span><span class="o">.</span><span class="n">msd</span><span class="p">,</span> <span class="n">taus</span><span class="p">))))</span>
    <span class="n">rtops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">qtdmri_fit</span><span class="o">.</span><span class="n">rtop</span><span class="p">,</span> <span class="n">taus</span><span class="p">))))</span>
    <span class="n">rtaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">qtdmri_fit</span><span class="o">.</span><span class="n">rtap</span><span class="p">,</span> <span class="n">taus</span><span class="p">))))</span>
    <span class="n">rtpps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">qtdmri_fit</span><span class="o">.</span><span class="n">rtpp</span><span class="p">,</span> <span class="n">taus</span><span class="p">))))</span>
</pre></div>
</div>
<p>The estimated <span class="math notranslate nohighlight">\(q\tau\)</span>-indices, for the chosen diffusion times, are now
stored in msds, rtops, rtaps and rtpps. The trends of these
<span class="math notranslate nohighlight">\(q\tau\)</span>-indices over time say something about the restriction of
diffusing particles over time, which is currently a hot topic in the dMRI
community. We evaluate the test-retest reproducibility for the two subjects by
plotting the <span class="math notranslate nohighlight">\(q\tau\)</span>-indices for each subject together. This example
will produce similar results as Fig. 10 in <span id="id5">[Fick2017]</span>.</p>
<p>We first define a small function to plot the mean and standard deviation of the
<span class="math notranslate nohighlight">\(q\tau\)</span>-index trends in a subject.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">plotcolor</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">std_mult</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">plotcolor</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">time</span><span class="p">,</span>
                    <span class="n">means</span> <span class="o">+</span> <span class="n">std_mult</span> <span class="o">*</span> <span class="n">stds</span><span class="p">,</span>
                    <span class="n">means</span> <span class="o">-</span> <span class="n">std_mult</span> <span class="o">*</span> <span class="n">stds</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plotcolor</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">means</span> <span class="o">+</span> <span class="n">std_mult</span> <span class="o">*</span> <span class="n">stds</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plotcolor</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">means</span> <span class="o">-</span> <span class="n">std_mult</span> <span class="o">*</span> <span class="n">stds</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plotcolor</span><span class="p">)</span>
</pre></div>
</div>
<p>We start by showing the test-retest MSD of both subjects over time. We plot the
<span class="math notranslate nohighlight">\(q\tau\)</span>-indices together with <span class="math notranslate nohighlight">\(q\tau\)</span>-index trends of free
diffusion with different diffusivities as background.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># we first generate the data to produce the background index isolines.</span>
<span class="n">Delta_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">MSD_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">4e-5</span><span class="p">,</span> <span class="mf">10e-5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">Delta_grid</span><span class="p">,</span> <span class="n">MSD_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">Delta_</span><span class="p">,</span> <span class="n">MSD_</span><span class="p">)</span>
<span class="n">D_grid</span> <span class="o">=</span> <span class="n">MSD_grid</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">Delta_grid</span><span class="p">)</span>
<span class="n">D_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-4</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1"># start with the plot of subject 1.</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># first plot the background</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">Delta_</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e5</span> <span class="o">*</span> <span class="n">MSD_</span><span class="p">,</span> <span class="n">D_grid</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">D_levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>

<span class="c1"># plot the test-retest mean MSD and standard deviation of subject 1.</span>
<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e5</span> <span class="o">*</span> <span class="n">msds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MSD Test&#39;</span><span class="p">)</span>
<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e5</span> <span class="o">*</span> <span class="n">msds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MSD Retest&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="c1"># plot some text markers to clarify the background diffusivity lines.</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">6.33</span><span class="p">,</span> <span class="s1">&#39;D=14e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">4.55</span><span class="p">,</span> <span class="s1">&#39;D=10e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">.009</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">0.0185</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Test-Retest MSD(:math:`\tau`) Subject 1&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Diffusion Time (ms)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MSD (:math:`10^{-5}mm^2`)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

<span class="c1"># then do the same thing for subject 2.</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">Delta_</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e5</span> <span class="o">*</span> <span class="n">MSD_</span><span class="p">,</span> <span class="n">D_grid</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">D_levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Free Diffusivity (:math:`mm^2/s`)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e5</span> <span class="o">*</span> <span class="n">msds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">)</span>
<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e5</span> <span class="o">*</span> <span class="n">msds</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">.009</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">0.0185</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Diffusion Time (ms)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Test-Retest MSD(:math:`\tau`) Subject 2&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;qt_indices_msd.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center">
<img alt="examples_built/reconstruction/qt_indices_msd.png" src="examples_built/reconstruction/qt_indices_msd.png" />
</figure>
<p>You can see that the MSD in both subjects increases over time, but also slowly
levels off as time progresses. This makes sense as diffusing particles are
becoming more restricted by surrounding tissue as time goes on. You can also
see that for Subject 1 the index trends nearly perfectly overlap, but for
subject 2 they are slightly off, which is also what we found in the paper.</p>
<p>Next, we follow the same procedure to estimate the test-retest RTAP, RTOP and
RTPP over diffusion time for both subject. For ease of comparison, we will
estimate all three in the same unit [1/mm] by taking the square root of RTAP
and the cubed root of RTOP.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Again, first we define the data for the background illustration.</span>
<span class="n">Delta_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">RTXP_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">Delta_grid</span><span class="p">,</span> <span class="n">RTXP_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">Delta_</span><span class="p">,</span> <span class="n">RTXP_</span><span class="p">)</span>
<span class="n">D_grid</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">RTXP_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Delta_grid</span><span class="p">)</span>
<span class="n">D_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-4</span>
<span class="n">D_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># We start with estimating the RTOP illustration.</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">Delta_</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">RTXP_</span><span class="p">,</span> <span class="n">D_grid</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">D_colors</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">D_levels</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>

<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">rtops</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RTOP:math:`^{1/3}` Test&#39;</span><span class="p">)</span>
<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">rtops</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">),</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RTOP:math:`^{1/3}` Retest&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="s1">&#39;D=3e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">22</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="s1">&#39;D=4e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="s1">&#39;D=6e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">.009</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">0.0185</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Test-Retest RTOP(:math:`\tau`) Subject 1&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Diffusion Time (ms)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RTOP:math:`^{1/3}` (1/mm)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">Delta_</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">RTXP_</span><span class="p">,</span> <span class="n">D_grid</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">D_colors</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">D_levels</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Free Diffusivity (:math:`mm^2/s`)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">rtops</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">rtops</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">),</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">.009</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">0.0185</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Diffusion Time (ms)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Test-Retest RTOP(:math:`\tau`) Subject 2&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;qt_indices_rtop.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center">
<img alt="examples_built/reconstruction/qt_indices_rtop.png" src="examples_built/reconstruction/qt_indices_rtop.png" />
</figure>
<p>Similarly as MSD, the RTOP is related to the restriction that particles are
experiencing and is also rotationally invariant. RTOP is defined as the
probability that particles are found at the same position at the time of both
gradient pulses. As time increases, the odds become smaller that a particle
will arrive at the same position it left, which is illustrated by all RTOP
trends in the figure. Notice that the estimated RTOP trends decrease less fast
than free diffusion, meaning that particles experience restriction over time.
Also notice that the RTOP trends in both subjects nearly perfectly overlap.</p>
<p>Next, we estimate two directional <span class="math notranslate nohighlight">\(q\tau\)</span>-indices, RTAP and RTPP,
describing particle restriction perpendicular and parallel to the orientation
of the principal diffusivity in that voxel. If the voxel describes coherent
white matter (which it does in our corpus callosum example), then they describe
properties related to restriction perpendicular and parallel to the axon
bundles.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, we estimate the RTAP trends.</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">Delta_</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">RTXP_</span><span class="p">,</span> <span class="n">D_grid</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">D_colors</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">D_levels</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>

<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rtaps</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RTAP:math:`^{1/2}` Test&#39;</span><span class="p">)</span>
<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rtaps</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RTAP:math:`^{1/2}` Retest&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="s1">&#39;D=3e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">22</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="s1">&#39;D=4e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="s1">&#39;D=6e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">.009</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">0.0185</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Test-Retest RTAP(:math:`\tau`) Subject 1&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Diffusion Time (ms)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RTAP:math:`^{1/2}` (1/mm)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">Delta_</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">RTXP_</span><span class="p">,</span> <span class="n">D_grid</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">D_colors</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">D_levels</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Free Diffusivity (:math:`mm^2/s`)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rtaps</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rtaps</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">.009</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">0.0185</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Diffusion Time (ms)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Test-Retest RTAP(:math:`\tau`) Subject 2&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;qt_indices_rtap.png&#39;</span><span class="p">)</span>


<span class="c1"># Finally the last one for RTPP.</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">Delta_</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">RTXP_</span><span class="p">,</span> <span class="n">D_grid</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">D_colors</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">D_levels</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>

<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">rtpps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RTPP Test&#39;</span><span class="p">)</span>
<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">rtpps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RTPP Retest&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="s1">&#39;D=6e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="s1">&#39;D=9e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.0091</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="s1">&#39;D=15e-4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">.009</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">0.0185</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Test-Retest RTPP(:math:`\tau`) Subject 1&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Diffusion Time (ms)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RTPP (1/mm)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">Delta_</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">RTXP_</span><span class="p">,</span> <span class="n">D_grid</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">D_colors</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">D_levels</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Free Diffusivity (:math:`mm^2/s`)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">rtpps</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plot_mean_with_std</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">taus</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">rtpps</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">.009</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">0.0185</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Diffusion Time (ms)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Test-Retest RTPP(:math:`\tau`) Subject 2&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;qt_indices_rtpp.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center">
<img alt="examples_built/reconstruction/qt_indices_rtap.png" src="examples_built/reconstruction/qt_indices_rtap.png" />
</figure>
<figure class="align-center">
<img alt="examples_built/reconstruction/qt_indices_rtpp.png" src="examples_built/reconstruction/qt_indices_rtpp.png" />
</figure>
<p>As those of RTOP, the trends in RTAP and RTPP also decrease over time. It can
be seen that RTAP:math:<cite>^{1/2}</cite> is always bigger than RTPP, which makes sense as
particles in coherent white matter experience more restriction perpendicular to
the white matter orientation than parallel to it. Again, in both subjects the
test-retest RTAP and RTPP is nearly perfectly consistent.</p>
<p>Aside from the estimation of <span class="math notranslate nohighlight">\(q\tau\)</span>-space indices, <span class="math notranslate nohighlight">\(q\tau\)</span>-dMRI
also allows for the estimation of time-dependent ODFs. Once the Qtdmri model
is fitted it can be simply called by qtdmri_fit.odf(sphere,
s=sharpening_factor). This is identical to how the mapmri module functions,
and allows to study the time-dependence of ODF directionality.</p>
<p>This concludes the example on qt-dMRI. As we showed, approaches such as qt-dMRI
can help in studying the (finite-<span class="math notranslate nohighlight">\(\tau\)</span>) temporal properties of diffusion
in biological tissues. Differences in <span class="math notranslate nohighlight">\(q\tau\)</span>-index trends could be
indicative of underlying structural differences that affect the time-dependence
of the diffusion process.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-built-reconstruction-reconst-qtdmri-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/fbb7c917b00bdaed49a9aa07823200c7/reconst_qtdmri.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">reconst_qtdmri.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/1af02520a79f9d26dac286b6fa0b5ab8/reconst_qtdmri.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">reconst_qtdmri.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  
<script type="module" src="../../_static/scripts/grg-sphinx-theme.js"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2008-2023, dipy developers &lt;neuroimaging@python.org&gt;.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

    <div class="copyright-text">
      <i class="fa-regular fa-copyright"></i> 
    </div>
  </footer>
  </body>
</html>