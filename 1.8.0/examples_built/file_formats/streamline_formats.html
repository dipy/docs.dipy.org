
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>DIPY &#8212; dipy 1.8.0dev0 documentation</title>
  
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/dipy.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

  
<link rel="stylesheet" href="../../_static/styles/grg-sphinx-theme.css"/>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples_built/file_formats/streamline_formats';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

  <meta name="keywords" content="DIPY, dMRI, DTI, DSI, diffusion MRI, Tensor,
  neuroimaging, python, neuroscience, Eleftherios, Garyfallidis, tractography,
  streamlines, fiber tracking">




  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
<nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">dipy 1.8.0dev0 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../stateoftheart.html">
                        A quick overview of features
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

</nav>
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../stateoftheart.html">
                        A quick overview of features
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">DIPY</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
<div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-built-file-formats-streamline-formats-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="read-write-streamline-files">
<span id="sphx-glr-examples-built-file-formats-streamline-formats-py"></span><h1>Read/Write streamline files<a class="headerlink" href="#read-write-streamline-files" title="Permalink to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="http://dipy.org">DIPY</a> can read and write many different file formats. In this example
we give a short introduction on how to use it for loading or saving
streamlines. The new stateful tractogram class was made to reduce errors
caused by spatial transformation and complex file format convention.</p>
<p>Read <a class="reference internal" href="../../faq.html#faq"><span class="std std-ref">Frequently Asked Questions</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dipy.io.stateful_tractogram</span> <span class="kn">import</span> <span class="n">Space</span><span class="p">,</span> <span class="n">StatefulTractogram</span>
<span class="kn">from</span> <span class="nn">dipy.io.streamline</span> <span class="kn">import</span> <span class="n">load_tractogram</span><span class="p">,</span> <span class="n">save_tractogram</span>
<span class="kn">from</span> <span class="nn">dipy.io.utils</span> <span class="kn">import</span> <span class="p">(</span><span class="n">create_nifti_header</span><span class="p">,</span> <span class="n">get_reference_info</span><span class="p">,</span>
                           <span class="n">is_header_compatible</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">dipy.tracking.streamline</span> <span class="kn">import</span> <span class="n">select_random_set_of_streamlines</span>
<span class="kn">from</span> <span class="nn">dipy.tracking.utils</span> <span class="kn">import</span> <span class="n">density_map</span>

<span class="kn">from</span> <span class="nn">dipy.data.fetcher</span> <span class="kn">import</span> <span class="p">(</span><span class="n">fetch_file_formats</span><span class="p">,</span>
                               <span class="n">get_file_formats</span><span class="p">)</span>
</pre></div>
</div>
<p>First fetch the dataset that contains 5 tractography file of 5 file formats:</p>
<ul class="simple">
<li><p>cc_m_sub.trk</p></li>
<li><p>laf_m_sub.tck</p></li>
<li><p>lpt_m_sub.fib</p></li>
<li><p>raf_m_sub.vtk</p></li>
<li><p>rpt_m_sub.dpy</p></li>
</ul>
<p>And their reference anatomy, common to all 5 files:</p>
<ul class="simple">
<li><p>template0.nii.gz</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fetch_file_formats</span><span class="p">()</span>
<span class="n">bundles_filename</span><span class="p">,</span> <span class="n">ref_anat_filename</span> <span class="o">=</span> <span class="n">get_file_formats</span><span class="p">()</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">bundles_filename</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<span class="n">reference_anatomy</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ref_anat_filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Load tractogram will support 5 file formats, functions like load_trk or
load_tck will simply be restricted to one file format</p>
<p>TRK files contain their own header (when written properly), so they
technically do not need a reference. (See how below)</p>
<p><code class="docutils literal notranslate"><span class="pre">cc_trk</span> <span class="pre">=</span> <span class="pre">load_tractogram(bundles_filename[0],</span> <span class="pre">'same')</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cc_sft</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span><span class="n">bundles_filename</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reference_anatomy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cc_sft</span><span class="p">)</span>
<span class="n">laf_sft</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span><span class="n">bundles_filename</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reference_anatomy</span><span class="p">)</span>
<span class="n">raf_sft</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span><span class="n">bundles_filename</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">reference_anatomy</span><span class="p">)</span>
</pre></div>
</div>
<p>These files contain invalid streamlines (negative values once in voxel space)
This is not considered a valid tractography file, but it is possible to load
it anyway.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lpt_sft</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span><span class="n">bundles_filename</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">reference_anatomy</span><span class="p">,</span>
                          <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">rpt_sft</span> <span class="o">=</span> <span class="n">load_tractogram</span><span class="p">(</span><span class="n">bundles_filename</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">reference_anatomy</span><span class="p">,</span>
                          <span class="n">bbox_valid_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">load_tractogram</span></code> requires a reference, any of the following
inputs is considered valid (as long as they are in the same share space)
- Nifti filename
- Trk filename
- nib.nifti1.Nifti1Image
- nib.streamlines.trk.TrkFile
- nib.nifti1.Nifti1Header
- Trk header (dict)
- Stateful Tractogram</p>
<p>The reason why this parameter is required is to guarantee all information
related to space attributes is always present.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">affine</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">voxel_sizes</span><span class="p">,</span> <span class="n">voxel_order</span> <span class="o">=</span> <span class="n">get_reference_info</span><span class="p">(</span>
    <span class="n">reference_anatomy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">affine</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">voxel_sizes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">voxel_order</span><span class="p">)</span>
</pre></div>
</div>
<p>If you have a Trk file that was generated using a particular anatomy,
to be considered valid all fields must correspond between the headers.
It can be easily verified using this function, which also accept
the same variety of input as <code class="docutils literal notranslate"><span class="pre">get_reference_info</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">is_header_compatible</span><span class="p">(</span><span class="n">reference_anatomy</span><span class="p">,</span> <span class="n">bundles_filename</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<p>If a TRK was generated with a valid header, but the reference NIFTI was lost
a header can be generated to then generate a fake NIFTI file.</p>
<p>If you wish to manually save Trk and Tck file using nibabel streamlines
API for more freedom of action (not recommended for beginners) you can
create a valid header using create_tractogram_header</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nifti_header</span> <span class="o">=</span> <span class="n">create_nifti_header</span><span class="p">(</span><span class="n">affine</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">voxel_sizes</span><span class="p">)</span>
<span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dimensions</span><span class="p">),</span> <span class="n">affine</span><span class="p">,</span> <span class="n">nifti_header</span><span class="p">),</span>
         <span class="s1">&#39;fake.nii.gz&#39;</span><span class="p">)</span>
<span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">reference_anatomy</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ref_anat_filename</span><span class="p">))</span>
</pre></div>
</div>
<p>Once loaded, no matter the original file format, the stateful tractogram is
self-contained and maintains a valid state. By requiring a reference the
tractogram’s spatial transformation can be easily manipulated.</p>
<p>Let’s save all files as TRK to visualize in TrackVis for example.
However, when loaded the lpt and rpt files contain invalid streamlines and
for particular operations/tools/functions it is safer to remove them</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">save_tractogram</span><span class="p">(</span><span class="n">cc_sft</span><span class="p">,</span> <span class="s1">&#39;cc.trk&#39;</span><span class="p">)</span>
<span class="n">save_tractogram</span><span class="p">(</span><span class="n">laf_sft</span><span class="p">,</span> <span class="s1">&#39;laf.trk&#39;</span><span class="p">)</span>
<span class="n">save_tractogram</span><span class="p">(</span><span class="n">raf_sft</span><span class="p">,</span> <span class="s1">&#39;raf.trk&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">lpt_sft</span><span class="o">.</span><span class="n">is_bbox_in_vox_valid</span><span class="p">())</span>
<span class="n">lpt_sft</span><span class="o">.</span><span class="n">remove_invalid_streamlines</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lpt_sft</span><span class="o">.</span><span class="n">is_bbox_in_vox_valid</span><span class="p">())</span>
<span class="n">save_tractogram</span><span class="p">(</span><span class="n">lpt_sft</span><span class="p">,</span> <span class="s1">&#39;lpt.trk&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rpt_sft</span><span class="o">.</span><span class="n">is_bbox_in_vox_valid</span><span class="p">())</span>
<span class="n">rpt_sft</span><span class="o">.</span><span class="n">remove_invalid_streamlines</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rpt_sft</span><span class="o">.</span><span class="n">is_bbox_in_vox_valid</span><span class="p">())</span>
<span class="n">save_tractogram</span><span class="p">(</span><span class="n">rpt_sft</span><span class="p">,</span> <span class="s1">&#39;rpt.trk&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Some functions in DIPY require streamlines to be in voxel space so computation
can be performed on a grid (connectivity matrix, ROIs masking, density map).
The stateful tractogram class provides safe functions for such manipulation.
These functions can be called safely over and over, by knowing in which state
the tractogram is operating, and compute only necessary transformations</p>
<p>No matter the state, functions such as <code class="docutils literal notranslate"><span class="pre">save_tractogram</span></code> or
<code class="docutils literal notranslate"><span class="pre">removing_invalid_coordinates</span></code> can be called safely and the transformations
are handled internally when needed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cc_sft</span><span class="o">.</span><span class="n">to_voxmm</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cc_sft</span><span class="o">.</span><span class="n">space</span><span class="p">)</span>
<span class="n">cc_sft</span><span class="o">.</span><span class="n">to_rasmm</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cc_sft</span><span class="o">.</span><span class="n">space</span><span class="p">)</span>
</pre></div>
</div>
<p>Now let’s move them all to voxel space, subsample them to 100 streamlines,
compute a density map and save everything for visualisation in another
software such as Trackvis or MI-Brain.</p>
<p>To access volume information in a grid, the corner of the voxel must be
considered the origin in order to prevent negative values.
Any operation doing interpolation or accessing a grid must use the
function ‘to_vox()’ and ‘to_corner()’</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cc_sft</span><span class="o">.</span><span class="n">to_vox</span><span class="p">()</span>
<span class="n">laf_sft</span><span class="o">.</span><span class="n">to_vox</span><span class="p">()</span>
<span class="n">raf_sft</span><span class="o">.</span><span class="n">to_vox</span><span class="p">()</span>
<span class="n">lpt_sft</span><span class="o">.</span><span class="n">to_vox</span><span class="p">()</span>
<span class="n">rpt_sft</span><span class="o">.</span><span class="n">to_vox</span><span class="p">()</span>

<span class="n">cc_sft</span><span class="o">.</span><span class="n">to_corner</span><span class="p">()</span>
<span class="n">laf_sft</span><span class="o">.</span><span class="n">to_corner</span><span class="p">()</span>
<span class="n">raf_sft</span><span class="o">.</span><span class="n">to_corner</span><span class="p">()</span>
<span class="n">lpt_sft</span><span class="o">.</span><span class="n">to_corner</span><span class="p">()</span>
<span class="n">rpt_sft</span><span class="o">.</span><span class="n">to_corner</span><span class="p">()</span>

<span class="n">cc_streamlines_vox</span> <span class="o">=</span> <span class="n">select_random_set_of_streamlines</span><span class="p">(</span><span class="n">cc_sft</span><span class="o">.</span><span class="n">streamlines</span><span class="p">,</span>
                                                      <span class="mi">1000</span><span class="p">)</span>
<span class="n">laf_streamlines_vox</span> <span class="o">=</span> <span class="n">select_random_set_of_streamlines</span><span class="p">(</span><span class="n">laf_sft</span><span class="o">.</span><span class="n">streamlines</span><span class="p">,</span>
                                                       <span class="mi">1000</span><span class="p">)</span>
<span class="n">raf_streamlines_vox</span> <span class="o">=</span> <span class="n">select_random_set_of_streamlines</span><span class="p">(</span><span class="n">raf_sft</span><span class="o">.</span><span class="n">streamlines</span><span class="p">,</span>
                                                       <span class="mi">1000</span><span class="p">)</span>
<span class="n">lpt_streamlines_vox</span> <span class="o">=</span> <span class="n">select_random_set_of_streamlines</span><span class="p">(</span><span class="n">lpt_sft</span><span class="o">.</span><span class="n">streamlines</span><span class="p">,</span>
                                                       <span class="mi">1000</span><span class="p">)</span>
<span class="n">rpt_streamlines_vox</span> <span class="o">=</span> <span class="n">select_random_set_of_streamlines</span><span class="p">(</span><span class="n">rpt_sft</span><span class="o">.</span><span class="n">streamlines</span><span class="p">,</span>
                                                       <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Same dimensions for every stateful tractogram, can be re-use</span>
<span class="n">affine</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">voxel_sizes</span><span class="p">,</span> <span class="n">voxel_order</span> <span class="o">=</span> <span class="n">cc_sft</span><span class="o">.</span><span class="n">space_attributes</span>
<span class="n">cc_density</span> <span class="o">=</span> <span class="n">density_map</span><span class="p">(</span><span class="n">cc_streamlines_vox</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">dimensions</span><span class="p">)</span>
<span class="n">laf_density</span> <span class="o">=</span> <span class="n">density_map</span><span class="p">(</span><span class="n">laf_streamlines_vox</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">dimensions</span><span class="p">)</span>
<span class="n">raf_density</span> <span class="o">=</span> <span class="n">density_map</span><span class="p">(</span><span class="n">raf_streamlines_vox</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">dimensions</span><span class="p">)</span>
<span class="n">lpt_density</span> <span class="o">=</span> <span class="n">density_map</span><span class="p">(</span><span class="n">lpt_streamlines_vox</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">dimensions</span><span class="p">)</span>
<span class="n">rpt_density</span> <span class="o">=</span> <span class="n">density_map</span><span class="p">(</span><span class="n">rpt_streamlines_vox</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">dimensions</span><span class="p">)</span>
</pre></div>
</div>
<p>Replacing streamlines is possible, but if the state was modified between
operations such as this one is not recommended:
-&gt; cc_sft.streamlines = cc_streamlines_vox</p>
<p>It is recommended to re-create a new StatefulTractogram object and
explicitly specify in which space the streamlines are. Be careful to follow
the order of operations.</p>
<p>If the tractogram was from a Trk file with metadata, this will be lost.
If you wish to keep metadata while manipulating the number or the order
look at the function StatefulTractogram.remove_invalid_streamlines() for more
details</p>
<p>It is important to mention that once the object is created in a consistent state
the <code class="docutils literal notranslate"><span class="pre">save_tractogram</span></code> function will save a valid file. And then the function
<code class="docutils literal notranslate"><span class="pre">load_tractogram</span></code> will load them in a valid state.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cc_sft</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">cc_streamlines_vox</span><span class="p">,</span> <span class="n">reference_anatomy</span><span class="p">,</span> <span class="n">Space</span><span class="o">.</span><span class="n">VOX</span><span class="p">)</span>
<span class="n">laf_sft</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">laf_streamlines_vox</span><span class="p">,</span> <span class="n">reference_anatomy</span><span class="p">,</span> <span class="n">Space</span><span class="o">.</span><span class="n">VOX</span><span class="p">)</span>
<span class="n">raf_sft</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">raf_streamlines_vox</span><span class="p">,</span> <span class="n">reference_anatomy</span><span class="p">,</span> <span class="n">Space</span><span class="o">.</span><span class="n">VOX</span><span class="p">)</span>
<span class="n">lpt_sft</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">lpt_streamlines_vox</span><span class="p">,</span> <span class="n">reference_anatomy</span><span class="p">,</span> <span class="n">Space</span><span class="o">.</span><span class="n">VOX</span><span class="p">)</span>
<span class="n">rpt_sft</span> <span class="o">=</span> <span class="n">StatefulTractogram</span><span class="p">(</span><span class="n">rpt_streamlines_vox</span><span class="p">,</span> <span class="n">reference_anatomy</span><span class="p">,</span> <span class="n">Space</span><span class="o">.</span><span class="n">VOX</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cc_sft</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">laf_sft</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">raf_sft</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lpt_sft</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rpt_sft</span><span class="p">))</span>
<span class="n">save_tractogram</span><span class="p">(</span><span class="n">cc_sft</span><span class="p">,</span> <span class="s1">&#39;cc_1000.trk&#39;</span><span class="p">)</span>
<span class="n">save_tractogram</span><span class="p">(</span><span class="n">laf_sft</span><span class="p">,</span> <span class="s1">&#39;laf_1000.trk&#39;</span><span class="p">)</span>
<span class="n">save_tractogram</span><span class="p">(</span><span class="n">raf_sft</span><span class="p">,</span> <span class="s1">&#39;raf_1000.trk&#39;</span><span class="p">)</span>
<span class="n">save_tractogram</span><span class="p">(</span><span class="n">lpt_sft</span><span class="p">,</span> <span class="s1">&#39;lpt_1000.trk&#39;</span><span class="p">)</span>
<span class="n">save_tractogram</span><span class="p">(</span><span class="n">rpt_sft</span><span class="p">,</span> <span class="s1">&#39;rpt_1000.trk&#39;</span><span class="p">)</span>

<span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">cc_density</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="n">nifti_header</span><span class="p">),</span>
         <span class="s1">&#39;cc_density.nii.gz&#39;</span><span class="p">)</span>
<span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">laf_density</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="n">nifti_header</span><span class="p">),</span>
         <span class="s1">&#39;laf_density.nii.gz&#39;</span><span class="p">)</span>
<span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">raf_density</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="n">nifti_header</span><span class="p">),</span>
         <span class="s1">&#39;raf_density.nii.gz&#39;</span><span class="p">)</span>
<span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">lpt_density</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="n">nifti_header</span><span class="p">),</span>
         <span class="s1">&#39;lpt_density.nii.gz&#39;</span><span class="p">)</span>
<span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">rpt_density</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="n">nifti_header</span><span class="p">),</span>
         <span class="s1">&#39;rpt_density.nii.gz&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-built-file-formats-streamline-formats-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/120bb03e638036cb0ae64643174b7d32/streamline_formats.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">streamline_formats.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/efce044b8ccde1e6bc52938010ada0af/streamline_formats.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">streamline_formats.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  
<script type="module" src="../../_static/scripts/grg-sphinx-theme.js"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2008-2023, dipy developers &lt;neuroimaging@python.org&gt;.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

    <div class="copyright-text">
      <i class="fa-regular fa-copyright"></i> 
    </div>
  </footer>
  </body>
</html>