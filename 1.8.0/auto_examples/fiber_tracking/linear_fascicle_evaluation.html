
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>DIPY &#8212; dipy 1.8.0dev0 documentation</title>
  
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/dipy.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

  
<link rel="stylesheet" href="../../_static/styles/grg-sphinx-theme.css"/>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'auto_examples/fiber_tracking/linear_fascicle_evaluation';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

  <meta name="keywords" content="DIPY, dMRI, DTI, DSI, diffusion MRI, Tensor,
  neuroimaging, python, neuroscience, Eleftherios, Garyfallidis, tractography,
  streamlines, fiber tracking">




  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
<nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">dipy 1.8.0dev0 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../stateoftheart.html">
                        A quick overview of features
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

</nav>
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../documentation.html">
                        Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../stateoftheart.html">
                        A quick overview of features
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="surface_seed.html">Surface seeding for tractography</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking_deterministic.html">An introduction to the Deterministic Maximum Direction Getter</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking_ptt.html">Parallel Transport Tractography</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking_rumba.html">Tracking with Robust Unbiased Model-BAsed Spherical Deconvolution (RUMBA-SD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking_sfm.html">Tracking with the Sparse Fascicle Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking_bootstrap_peaks.html">Bootstrap and Closest Peak Direction Getters Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking_introduction_eudx_1.html">Introduction to Basic Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking_probabilistic.html">An introduction to the Probabilistic Direction Getter</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking_pft.html">Particle Filtering Tractography</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Linear fascicle evaluation (LiFE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking_stopping_criterion.html">Using Various Stopping Criterion for Tractography</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">DIPY</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
<div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-fiber-tracking-linear-fascicle-evaluation-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="linear-fascicle-evaluation-life">
<span id="sphx-glr-auto-examples-fiber-tracking-linear-fascicle-evaluation-py"></span><h1>Linear fascicle evaluation (LiFE)<a class="headerlink" href="#linear-fascicle-evaluation-life" title="Permalink to this heading">#</a></h1>
<p>Evaluating the results of tractography algorithms is one of the biggest
challenges for diffusion MRI. One proposal for evaluation of tractography
results is to use a forward model that predicts the signal from each of a set
of streamlines, and then fit a linear model to these simultaneous predictions
<a class="reference internal" href="../../examples_built/fiber_tracking/linear_fascicle_evaluation.html#pestilli2014" id="id1"><span>[Pestilli2014]</span></a>.</p>
<p>We will use streamlines generated using probabilistic tracking on CSA
peaks. For brevity, we will include in this example only streamlines going
through the corpus callosum connecting left to right superior frontal
cortex. The process of tracking and finding these streamlines is fully
demonstrated in the <a class="reference internal" href="../../examples_built/streamline_analysis/streamline_tools.html#streamline-tools"><span class="std std-ref">Connectivity Matrices, ROI Intersections and Density Maps</span></a> example. If this example has been
run, we can read the streamlines from file. Otherwise, we’ll run that example
first, by importing it. This provides us with all of the variables that were
created in that example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">pjoin</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">AxesGrid</span>

<span class="kn">import</span> <span class="nn">dipy.core.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="n">fetch_stanford_tracks</span>
<span class="kn">from</span> <span class="nn">dipy.io.streamline</span> <span class="kn">import</span> <a href="../../reference/dipy.io.html#dipy.io.streamline.load_trk" title="dipy.io.streamline.load_trk" class="sphx-glr-backref-module-dipy-io-streamline sphx-glr-backref-type-py-function"><span class="n">load_trk</span></a>
<span class="kn">import</span> <span class="nn">dipy.tracking.life</span> <span class="k">as</span> <span class="nn">life</span>
<span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="kn">import</span> <span class="n">window</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">colormap</span> <span class="k">as</span> <span class="n">cmap</span>

    <span class="c1"># We&#39;ll need to know where the corpus callosum is from these variables:</span>
<span class="kn">from</span> <span class="nn">dipy.core.gradients</span> <span class="kn">import</span> <a href="../../reference/dipy.core.html#dipy.core.gradients.gradient_table" title="dipy.core.gradients.gradient_table" class="sphx-glr-backref-module-dipy-core-gradients sphx-glr-backref-type-py-function"><span class="n">gradient_table</span></a>
<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="n">get_fnames</span>
<span class="kn">from</span> <span class="nn">dipy.io.gradients</span> <span class="kn">import</span> <span class="n">read_bvals_bvecs</span>
<span class="kn">from</span> <span class="nn">dipy.io.image</span> <span class="kn">import</span> <a href="../../reference/dipy.io.html#dipy.io.image.load_nifti_data" title="dipy.io.image.load_nifti_data" class="sphx-glr-backref-module-dipy-io-image sphx-glr-backref-type-py-function"><span class="n">load_nifti_data</span></a><span class="p">,</span> <a href="../../reference/dipy.io.html#dipy.io.image.load_nifti" title="dipy.io.image.load_nifti" class="sphx-glr-backref-module-dipy-io-image sphx-glr-backref-type-py-function"><span class="n">load_nifti</span></a>

<span class="n">hardi_fname</span><span class="p">,</span> <span class="n">hardi_bval_fname</span><span class="p">,</span> <span class="n">hardi_bvec_fname</span> <span class="o">=</span> <span class="n">get_fnames</span><span class="p">(</span><span class="s1">&#39;stanford_hardi&#39;</span><span class="p">)</span>
<span class="n">label_fname</span> <span class="o">=</span> <span class="n">get_fnames</span><span class="p">(</span><span class="s1">&#39;stanford_labels&#39;</span><span class="p">)</span>
<span class="n">t1_fname</span> <span class="o">=</span> <span class="n">get_fnames</span><span class="p">(</span><span class="s1">&#39;stanford_t1&#39;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="n">hardi_img</span> <span class="o">=</span> <a href="../../reference/dipy.io.html#dipy.io.image.load_nifti" title="dipy.io.image.load_nifti" class="sphx-glr-backref-module-dipy-io-image sphx-glr-backref-type-py-function"><span class="n">load_nifti</span></a><span class="p">(</span><span class="n">hardi_fname</span><span class="p">,</span> <span class="n">return_img</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <a href="../../reference/dipy.io.html#dipy.io.image.load_nifti_data" title="dipy.io.image.load_nifti_data" class="sphx-glr-backref-module-dipy-io-image sphx-glr-backref-type-py-function"><span class="n">load_nifti_data</span></a><span class="p">(</span><span class="n">label_fname</span><span class="p">)</span>
<span class="n">t1_data</span> <span class="o">=</span> <a href="../../reference/dipy.io.html#dipy.io.image.load_nifti_data" title="dipy.io.image.load_nifti_data" class="sphx-glr-backref-module-dipy-io-image sphx-glr-backref-type-py-function"><span class="n">load_nifti_data</span></a><span class="p">(</span><span class="n">t1_fname</span><span class="p">)</span>
<span class="n">bvals</span><span class="p">,</span> <span class="n">bvecs</span> <span class="o">=</span> <span class="n">read_bvals_bvecs</span><span class="p">(</span><span class="n">hardi_bval_fname</span><span class="p">,</span> <span class="n">hardi_bvec_fname</span><span class="p">)</span>
<span class="n">gtab</span> <span class="o">=</span> <a href="../../reference/dipy.core.html#dipy.core.gradients.gradient_table" title="dipy.core.gradients.gradient_table" class="sphx-glr-backref-module-dipy-core-gradients sphx-glr-backref-type-py-function"><span class="n">gradient_table</span></a><span class="p">(</span><span class="n">bvals</span><span class="p">,</span> <span class="n">bvecs</span><span class="p">)</span>

<span class="n">cc_slice</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">==</span> <span class="mi">2</span>

<span class="c1"># Let&#39;s now fetch a set of streamlines from the Stanford HARDI dataset.</span>
<span class="c1"># Those streamlines were generated during the :ref:`streamline_tools` example.</span>
<span class="c1"># Read the candidates from file in voxel space:</span>

<span class="n">streamlines_files</span> <span class="o">=</span> <span class="n">fetch_stanford_tracks</span><span class="p">()</span>
<span class="n">lr_superiorfrontal_path</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">streamlines_files</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="s1">&#39;hardi-lr-superiorfrontal.trk&#39;</span><span class="p">)</span>

<span class="n">candidate_sl_sft</span> <span class="o">=</span> <a href="../../reference/dipy.io.html#dipy.io.streamline.load_trk" title="dipy.io.streamline.load_trk" class="sphx-glr-backref-module-dipy-io-streamline sphx-glr-backref-type-py-function"><span class="n">load_trk</span></a><span class="p">(</span><span class="n">lr_superiorfrontal_path</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
<span class="n">candidate_sl_sft</span><span class="o">.</span><span class="n">to_vox</span><span class="p">()</span>
<span class="n">candidate_sl</span> <span class="o">=</span> <span class="n">candidate_sl_sft</span><span class="o">.</span><span class="n">streamlines</span>
</pre></div>
</div>
<p>The streamlines that are entered into the model are termed ‘candidate
streamlines’ (or a ‘candidate connectome’):</p>
<p>Let’s visualize the initial candidate group of streamlines in 3D, relative to
the anatomical structure of this brain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enables/disables interactive visualization</span>
<span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">candidate_streamlines_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">streamtube</span><span class="p">(</span><span class="n">candidate_sl</span><span class="p">,</span>
                                               <span class="n">cmap</span><span class="o">.</span><span class="n">line_colors</span><span class="p">(</span><span class="n">candidate_sl</span><span class="p">))</span>
<span class="n">cc_ROI_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">contour_from_roi</span><span class="p">(</span><span class="n">cc_slice</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
                                      <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">vol_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">slicer</span><span class="p">(</span><span class="n">t1_data</span><span class="p">)</span>

<span class="n">vol_actor</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">vol_actor2</span> <span class="o">=</span> <span class="n">vol_actor</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">vol_actor2</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>

<span class="c1"># Add display objects to canvas</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">candidate_streamlines_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cc_ROI_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vol_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vol_actor2</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;life_candidates.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id4">
<img alt="auto_examples/fiber_tracking/life_candidates.png" src="auto_examples/fiber_tracking/life_candidates.png" />
<figcaption>
<p><span class="caption-text"><strong>Candidate connectome before life optimization</strong></span><a class="headerlink" href="#id4" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Next, we initialize a LiFE model. We import the <code class="docutils literal notranslate"><span class="pre">dipy.tracking.life</span></code> module,
which contains the classes and functions that implement the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fiber_model</span> <span class="o">=</span> <a href="../../reference/dipy.tracking.html#dipy.tracking.life.FiberModel" title="dipy.tracking.life.FiberModel" class="sphx-glr-backref-module-dipy-tracking-life sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">life</span><span class="o">.</span><span class="n">FiberModel</span></a><span class="p">(</span><span class="n">gtab</span><span class="p">)</span>
</pre></div>
</div>
<p>Since we read the streamlines from a file, already in the voxel space, we do
not need to transform them into this space. Otherwise, if the streamline
coordinates were in the world space (relative to the scanner iso-center, or
relative to the mid-point of the AC-PC-connecting line), we would use this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inv_affine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">hardi_img</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span>
</pre></div>
</div>
<p>the inverse transformation from world space to the voxel space as the affine
for the following model fit.</p>
<p>The next step is to fit the model, producing a <code class="docutils literal notranslate"><span class="pre">FiberFit</span></code> class instance,
that stores the data, as well as the results of the fitting procedure.</p>
<p>The LiFE model posits that the signal in the diffusion MRI volume can be
explained by the streamlines, by the equation</p>
<div class="math notranslate nohighlight">
\[y = X\beta\]</div>
<p>Where <span class="math notranslate nohighlight">\(y\)</span> is the diffusion MRI signal, <span class="math notranslate nohighlight">\(\beta\)</span> are a set of weights on the
streamlines and <span class="math notranslate nohighlight">\(X\)</span> is a design matrix. This matrix has the dimensions <span class="math notranslate nohighlight">\(m\)</span> by
<span class="math notranslate nohighlight">\(n\)</span>, where <span class="math notranslate nohighlight">\(m=n_{voxels} \cdot n_{directions}\)</span>, and <span class="math notranslate nohighlight">\(n_{voxels}\)</span> is the set of
voxels in the ROI that contains the streamlines considered in this model. The
<span class="math notranslate nohighlight">\(i^{th}\)</span> column of the matrix contains the expected contributions of the
<span class="math notranslate nohighlight">\(i^{th}\)</span> streamline (arbitrarily ordered) to each of the voxels. <span class="math notranslate nohighlight">\(X\)</span> is a
sparse matrix, because each streamline traverses only a small percentage of the
voxels. The  expected contributions of the streamline are calculated using a
forward model, where each node of the streamline is modeled as a cylindrical
fiber compartment with Gaussian diffusion, using the diffusion tensor model.
See <a class="reference internal" href="../../examples_built/fiber_tracking/linear_fascicle_evaluation.html#pestilli2014" id="id2"><span>[Pestilli2014]</span></a> for more detail on the model, and variations of this model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fiber_fit</span> <span class="o">=</span> <span class="n">fiber_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">candidate_sl</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">FiberFit</span></code> class instance holds various properties of the model fit. For
example, it has the weights <span class="math notranslate nohighlight">\(\beta\)</span>, that are assigned to each streamline. In
most cases, a tractography through some region will include redundant
streamlines, and these streamlines will have <span class="math notranslate nohighlight">\(\beta_i\)</span> that are 0.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fiber_fit</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Fiber weights&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# fibers&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;beta_histogram.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id5">
<img alt="auto_examples/fiber_tracking/beta_histogram.png" src="auto_examples/fiber_tracking/beta_histogram.png" />
<figcaption>
<p><span class="caption-text"><strong>LiFE streamline weights</strong></span><a class="headerlink" href="#id5" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We use <span class="math notranslate nohighlight">\(\beta\)</span> to filter out these redundant streamlines, and generate an
optimized group of streamlines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">optimized_sl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">row_stack</span><span class="p">(</span><span class="n">candidate_sl</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fiber_fit</span><span class="o">.</span><span class="n">beta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]]</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">streamtube</span><span class="p">(</span><span class="n">optimized_sl</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">line_colors</span><span class="p">(</span><span class="n">optimized_sl</span><span class="p">)))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cc_ROI_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vol_actor</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;life_optimized.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">))</span>
<span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id6">
<img alt="auto_examples/fiber_tracking/life_optimized.png" src="auto_examples/fiber_tracking/life_optimized.png" />
<figcaption>
<p><span class="caption-text"><strong>Streamlines selected via LiFE optimization</strong></span><a class="headerlink" href="#id6" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The new set of streamlines should do well in fitting the data, and redundant
streamlines have presumably been removed (in this case, about 50% of the
streamlines).</p>
<p>But how well does the model do in explaining the diffusion data? We can
quantify that: the <code class="docutils literal notranslate"><span class="pre">FiberFit</span></code> class instance has a <cite>predict</cite> method, which
can be used to invert the model and predict back either the data that was used
to fit the model, or other unseen data (e.g. in cross-validation, see
<a class="reference internal" href="../../examples_built/reconstruction/kfold_xval.html#sphx-glr-examples-built-reconstruction-kfold-xval-py"><span class="std std-ref">K-fold cross-validation for model comparison</span></a>).</p>
<p>Without arguments, the <code class="docutils literal notranslate"><span class="pre">.predict()</span></code> method will predict the diffusion signal
for the same gradient table that was used in the fit data, but <code class="docutils literal notranslate"><span class="pre">gtab</span></code> and
<code class="docutils literal notranslate"><span class="pre">S0</span></code> keyword arguments can be used to predict for other acquisition schemes
and other baseline non-diffusion-weighted signals.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_predict</span> <span class="o">=</span> <span class="n">fiber_fit</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</pre></div>
</div>
<p>We will focus on the error in prediction of the diffusion-weighted data, and
calculate the root of the mean squared error.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_error</span> <span class="o">=</span> <span class="n">model_predict</span> <span class="o">-</span> <span class="n">fiber_fit</span><span class="o">.</span><span class="n">data</span>
<span class="n">model_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">model_error</span><span class="p">[:,</span> <span class="mi">10</span><span class="p">:]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>As a baseline against which we can compare, we calculate another error term. In
this case, we assume that the weight for each streamline is equal
to zero. This produces the naive prediction of the mean of the signal in each
voxel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beta_baseline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">fiber_fit</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">pred_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><a href="../../reference/dipy.core.html#dipy.core.optimize.spdot" title="dipy.core.optimize.spdot" class="sphx-glr-backref-module-dipy-core-optimize sphx-glr-backref-type-py-function"><span class="n">opt</span><span class="o">.</span><span class="n">spdot</span></a><span class="p">(</span><span class="n">fiber_fit</span><span class="o">.</span><span class="n">life_matrix</span><span class="p">,</span> <span class="n">beta_baseline</span><span class="p">),</span>
                           <span class="p">(</span><span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">gtab</span><span class="o">.</span><span class="n">b0s_mask</span><span class="p">)))</span>
<span class="n">mean_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gtab</span><span class="o">.</span><span class="n">bvals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">S0</span> <span class="o">=</span> <span class="n">fiber_fit</span><span class="o">.</span><span class="n">b0_signal</span>
</pre></div>
</div>
<p>Since the fitting is done in the demeaned S/S0 domain, we need
to add back the mean and then multiply by S0 in every voxel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mean_pred</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">gtab</span><span class="o">.</span><span class="n">b0s_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">S0</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">mean_pred</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">~</span><span class="n">gtab</span><span class="o">.</span><span class="n">b0s_mask</span><span class="p">]</span> <span class="o">=</span>\
    <span class="p">(</span><span class="n">pred_weighted</span> <span class="o">+</span> <span class="n">fiber_fit</span><span class="o">.</span><span class="n">mean_signal</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">*</span> <span class="n">S0</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">mean_error</span> <span class="o">=</span> <span class="n">mean_pred</span> <span class="o">-</span> <span class="n">fiber_fit</span><span class="o">.</span><span class="n">data</span>
<span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_error</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>First, we can compare the overall distribution of errors between these two
alternative models of the ROI. We show the distribution of differences in error
(improvement through model fitting, relative to the baseline model). Here,
positive values denote an improvement in error with model fit, relative to
without the model fit.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mean_rmse</span> <span class="o">-</span> <span class="n">model_rmse</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;Median RMSE, mean model: </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">mean_rmse</span><span class="p">),</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;Median RMSE, LiFE: </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">model_rmse</span><span class="p">),</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMS Error&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# voxels&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;error_histograms.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id7">
<img alt="auto_examples/fiber_tracking/error_histograms.png" src="auto_examples/fiber_tracking/error_histograms.png" />
<figcaption>
<p><span class="caption-text">Improvement in error with fitting of the LiFE model.</span><a class="headerlink" href="#id7" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Second, we can show the spatial distribution of the two error terms,
and of the improvement with the model fit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vol_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">vol_model</span><span class="p">[</span><span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
          <span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
          <span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">model_rmse</span>
<span class="n">vol_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">vol_mean</span><span class="p">[</span><span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
         <span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
         <span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mean_rmse</span>
<span class="n">vol_improve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">vol_improve</span><span class="p">[</span><span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">fiber_fit</span><span class="o">.</span><span class="n">vox_coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mean_rmse</span> <span class="o">-</span> <span class="n">model_rmse</span>
<span class="n">sl_idx</span> <span class="o">=</span> <span class="mi">49</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">AxesGrid</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span>
              <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
              <span class="n">label_mode</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
              <span class="n">share_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">cbar_location</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
              <span class="n">cbar_mode</span><span class="o">=</span><span class="s2">&quot;each&quot;</span><span class="p">,</span>
              <span class="n">cbar_size</span><span class="o">=</span><span class="s2">&quot;10%&quot;</span><span class="p">,</span>
              <span class="n">cbar_pad</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">t1_data</span><span class="p">[</span><span class="n">sl_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">vol_model</span><span class="p">[</span><span class="n">sl_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">cbar_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">t1_data</span><span class="p">[</span><span class="n">sl_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">vol_mean</span><span class="p">[</span><span class="n">sl_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">cbar_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">t1_data</span><span class="p">[</span><span class="n">sl_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bone</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">vol_improve</span><span class="p">[</span><span class="n">sl_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">cbar_axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lax</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">lax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">lax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;spatial_errors.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id8">
<img alt="auto_examples/fiber_tracking/spatial_errors.png" src="auto_examples/fiber_tracking/spatial_errors.png" />
<figcaption>
<p><span class="caption-text">Spatial distribution of error and improvement.</span><a class="headerlink" href="#id8" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>This image demonstrates that in many places, fitting the LiFE model results in
substantial reduction of the error.</p>
<p>Note that for full-brain tractographies <em>LiFE</em> can require large amounts of
memory. For detailed memory profiling of the algorithm, based on the
streamlines generated in
<a class="reference internal" href="../../examples_built/fiber_tracking/tracking_probabilistic.html#sphx-glr-examples-built-fiber-tracking-tracking-probabilistic-py"><span class="std std-ref">An introduction to the Probabilistic Direction Getter</span></a>, see
<a class="reference external" href="http://nbviewer.ipython.org/gist/arokem/bc29f34ebc97510d9def">this IPython notebook</a>.</p>
<p>For the Matlab implementation of LiFE, head over to <a class="reference external" href="http://francopestilli.github.io/life/">Franco Pestilli’s github
webpage</a>.</p>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<div role="list" class="citation-list">
<div class="citation" id="pestilli2014" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Pestilli2014<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id2">2</a>)</span>
<p>Pestilli, F., Yeatman, J, Rokem, A. Kay, K. and Wandell B.A.
(2014). Validation and statistical inference in living connectomes. Nature
Methods 11: 1058-1063. doi:10.1038/nmeth.3098</p>
</div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-fiber-tracking-linear-fascicle-evaluation-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/38782293e2efda02ab2ee87d6197e072/linear_fascicle_evaluation.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">linear_fascicle_evaluation.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/de1a9c7f20a12b4b5dced4f0445ad088/linear_fascicle_evaluation.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">linear_fascicle_evaluation.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  
<script type="module" src="../../_static/scripts/grg-sphinx-theme.js"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2008-2023, dipy developers &lt;neuroimaging@python.org&gt;.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

    <div class="copyright-text">
      <i class="fa-regular fa-copyright"></i> 
    </div>
  </footer>
  </body>
</html>