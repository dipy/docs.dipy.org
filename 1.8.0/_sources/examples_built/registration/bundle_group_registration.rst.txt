
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples_built\registration\bundle_group_registration.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_examples_built_registration_bundle_group_registration.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_built_registration_bundle_group_registration.py:


=============================
Groupwise Bundle Registration
=============================

This example explains how to coregister a set of bundles to a common space that
is not biased by any specific bundle. This is useful when we want to align all
the bundles but do not have a target reference space defined by an atlas.

How it works
============

The bundle groupwise registration framework in DIPY relies on streamline linear
registration (SLR) [Garyfallidis15]_ and an iterative process.

In each iteration, bundles are shuffled and matched in pairs. Then, each pair
of bundles are simultaneously moved to a common space in between both.

After all pairs have been aligned, a group distance metric is computed as the
mean pairwise distance between all bundle pairs. With each iteration, bundles
get closer to each other and the group distance decreases.

When the reduction in the group distance reaches a tolerance level the process
ends.

To reduce computational time, by default both registration and distance
computation are performed on streamline centroids (obtained with Quickbundles)
[Garyfallidis12]_.

Example
=======

We start by importing and creating the necessary functions:

.. GENERATED FROM PYTHON SOURCE LINES 35-43

.. code-block:: Python


    from dipy.align.streamlinear import groupwise_slr
    from dipy.data import read_five_af_bundles
    from dipy.viz.streamline import show_bundles

    import logging
    logging.basicConfig(level=logging.INFO)








.. GENERATED FROM PYTHON SOURCE LINES 44-48

To run groupwise registration we need to have our input bundles stored in a
list.

Here we load 5 left arcuate fasciculi and store them in a list.

.. GENERATED FROM PYTHON SOURCE LINES 48-51

.. code-block:: Python


    bundles = read_five_af_bundles()








.. GENERATED FROM PYTHON SOURCE LINES 52-53

Let's now visualize our input bundles:

.. GENERATED FROM PYTHON SOURCE LINES 53-60

.. code-block:: Python


    colors = [[0.91, 0.26, 0.35], [0.99, 0.50, 0.38], [0.99, 0.88, 0.57],
              [0.69, 0.85, 0.64], [0.51, 0.51, 0.63]]

    show_bundles(bundles, interactive=False, colors=colors,
                 save_as='before_group_registration.png')




.. image-sg:: /examples_built/registration/images/sphx_glr_bundle_group_registration_001.png
   :alt: bundle group registration
   :srcset: /examples_built/registration/images/sphx_glr_bundle_group_registration_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 61-69

.. rst-class:: centered small fst-italic fw-semibold

Bundles before registration.


They are in native space and, therefore, not aligned.

Now running groupwise registration is as simple as:

.. GENERATED FROM PYTHON SOURCE LINES 69-72

.. code-block:: Python


    bundles_reg, aff, d = groupwise_slr(bundles, verbose=True)








.. GENERATED FROM PYTHON SOURCE LINES 73-75

Finally, we visualize the registered bundles to confirm that they are now in
a common space:

.. GENERATED FROM PYTHON SOURCE LINES 75-79

.. code-block:: Python


    show_bundles(bundles_reg, interactive=False, colors=colors,
                 save_as='after_group_registration.png')




.. image-sg:: /examples_built/registration/images/sphx_glr_bundle_group_registration_002.png
   :alt: bundle group registration
   :srcset: /examples_built/registration/images/sphx_glr_bundle_group_registration_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 80-109

.. rst-class:: centered small fst-italic fw-semibold

Bundles after registration.



Extended capabilities
=====================

In addition to the registered bundles, `groupwise_slr` also returns a list
with the individual transformation matrices as well as the pairwise distances
computed in each iteration.

By changing the input arguments the user can modify the transformation (up to
affine), the number of maximum number of streamlines per bundle, the level of
clustering, or the tolerance of the method.

References
----------

.. [Garyfallidis15] Garyfallidis et al., "Robust and efficient linear
                    registration of white-matter fascicles in the space of
                    streamlines", Neuroimage, 117:124-140, 2015.
.. [Garyfallidis12] Garyfallidis E. et al., "QuickBundles a method for
                    tractography simplification", Frontiers in Neuroscience,
                    vol 6, no 175, 2012.
.. [RomeroBascones22] Romero-Bascones D. et al., "BundleAtlasing: unbiased
                    population-specific atlasing of bundles in streamline
                    space", ISMRM, 2022.

.. GENERATED FROM PYTHON SOURCE LINES 111-113

.. include:: ../../links_names.inc



.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 3.560 seconds)


.. _sphx_glr_download_examples_built_registration_bundle_group_registration.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: bundle_group_registration.ipynb <bundle_group_registration.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: bundle_group_registration.py <bundle_group_registration.py>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
